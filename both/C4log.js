/// <reference path="../typescript-defs/all-definitions.d.ts"/>
/// <reference path="../typescript-defs/stack-trace.d.ts"/>
console.log("Loading AppLog.ts ...");
class AppLog {
    static start() {
        return true;
    }
    static stackTrace() {
        var err = new Error();
        return err["stack"];
    }
    static printThis(theObject) {
        //console.log(JSON.stringify(theObject, null, 7));
    }
    static defaultExceptionHandler(msg, url, line, col, error) {
        var extra = !col ? '' : '\ncolumn: ' + col;
        extra += !error ? '' : '\nerror: ' + error;
        var message = "Error: " + msg + "<br> url:" + url + "<br> nline:" + line + "<br>" + extra;
        webix.modalbox({
            title: "Uncaught Exception Eerror",
            buttons: ["ok", "Not OK"],
            text: message,
            width: "800px",
        });
        AppLog.error(msg, error, {
            msg: msg,
            url: url,
            line: line,
            col: col,
            error: col
        });
        var suppressErrorAlert = true;
    }
    static record(message, error, object) {
        AppLog.log("record", message, error, object, true);
    }
    static error(message, error, object) {
        if (typeof window != "undefined") {
            UI.Error(message);
        }
        AppLog.log("error", message, error, object);
        debugger;
    }
    static info(message, error, object) {
        if (AppLog.infoReport)
            AppLog.log("info", message, error, object);
    }
    static GPSReturn(result) {
        console.error("GPSReturn");
        console.error(result);
    }
    static GPSReturnError(result) {
        console.error("GPSReturn Error");
        console.error("Error");
        console.error(result);
    }
    static CreateGoodStack(stack) {
        console.error("StackTrace");
        console.error(stack);
        var stackFrame = new StackFrame(stack[0].functionName, [], stack[0].fileName, stack[0].lineNumber, stack[0].columnNumber);
        /*
         AppLog.gps.getMappedLocation(stackFrame).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);


         AppLog.gps.getMappedLocation(stack[0]).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);
         */
    }
    static log(type, message, error, object, database = false) {
        // var caller = arguments.callee.caller.toString();
        // if (!AppLog.gps) {
        //    AppLog.gps = new StackTraceGPS();
        // }
        if (error) {
            var theStack = error["stack"];
        }
        else
            theStack = "";
        if (type == "info" && !AppLog.info)
            return;
        var description = type + " " + message + " " + error;
        /*
         if (window) {
         var theNavigator = navigator
         }
         else theNavigator = null;
         */
        var theNavigator = null;
        if (!AppLog.noDB)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        else if ((AppLog.errorOnlyDB && type == "error") || database)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        //console.error("Navigator : "+ AppLog.prettyPrint(theNavigator));
        //console.error("Caller : " + caller)
        console.error(description);
        if (type == "error") {
            console.error(error);
            console.error(AppLog.prettyPrint(theStack));
        }
        if (object)
            if (AppLog.printObjects)
                console.error(AppLog.prettyPrint(object));
    }
    static StackToString(theStack) {
        var theString = "";
        for (var item in theStack) {
            theString += theStack[item] + "\n";
        }
        return theString;
    }
    static PrintObject(object) {
        return JSON.stringify(object, null, 4);
    }
    static cast(theObject) {
        return theObject;
    }
    static MakeJSON(object) {
        return JSON.stringify(JSON.decycle(object), null, 4);
    }
    static Add(type, message, error, object, caller, browser) {
        var theDescription = type + " " + message + " " + error;
        var objectArray = new Array();
        try {
            if (error) {
                objectArray[0] = error;
                var errorJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Error";
                var errorJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (object) {
                objectArray[0] = object;
                var objectJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Object";
                var objectJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (browser) {
                objectArray[0] = browser;
                var browserJson = AppLog.MakeJSON((objectArray));
            }
            else {
                objectArray[0] = "No Object";
                browserJson = AppLog.MakeJSON((objectArray));
            }
        }
        catch (e) {
        }
        try {
            C4logDB.insert({
                type: type,
                message: message,
                description: theDescription,
                errorObject: errorJson,
                object: objectJson,
                caller: caller,
                browser: browserJson
            });
        }
        catch (e) {
            console.log("Error Logging C4 Error in DB");
            return;
        }
    }
    static prettyPrint(obj, indent = 0) {
        if (!obj)
            return "null";
        var toString = Object.prototype.toString, newLine = "<br>", space = "&nbsp;", tab = 8, buffer = "", 
        //Second argument is indent
        //For better performance, Cache indentStr for a given indent.
        indentStr = (function (n) {
            var str = "";
            while (n--) {
                str += space;
            }
            return str;
        })(indent);
        if (!obj || (typeof obj != "object" && typeof obj != "function")) {
            //any non-object ( Boolean, String, Number), null, undefined, NaN
            buffer += obj;
        }
        else if (toString.call(obj) == "[object Date]") {
            buffer += "[Date] " + obj;
        }
        else if (toString.call(obj) == "[object RegExp") {
            buffer += "[RegExp] " + obj;
        }
        else if (toString.call(obj) == "[object Function]") {
            buffer += "[Function] " + obj;
        }
        else if (toString.call(obj) == "[object Array]") {
            var idx = 0, len = obj.length;
            buffer += "[" + newLine;
            while (idx < len) {
                buffer += [
                    indentStr, idx, ": ",
                    AppLog.prettyPrint(obj[idx], indent + tab)
                ].join("");
                buffer += "<br>";
                idx++;
            }
            buffer += indentStr + "]";
        }
        else {
            var prop;
            buffer += "{" + newLine;
            for (prop in obj) {
                buffer += [
                    indentStr, prop, ": ",
                    AppLog.prettyPrint(obj[prop], indent + tab)
                ].join("");
                buffer += newLine;
            }
            buffer += indentStr + "}";
        }
        return buffer;
    }
}
AppLog.infoReport = true;
AppLog.noDB = true;
AppLog.errorOnlyDB = true;
AppLog.printObjects = false;
AppLog.initialize = AppLog.start();
AppLog.gps = false;
this.AppLog = AppLog;
this.jobLogger = function (opts) {
    AppLog.info("Job Logger Message : " + opts.message + " Level : " + opts.level, new Error(), {
        level: opts.level,
        message: opts.message,
        tags: opts.tag
    });
};
class VideoApp {
    static assert(condition, message, error, object) {
        if (!condition) {
            AppLog.error("Assertion " + message, error, object);
            debugger;
            message = message || "Assertion failed";
            if (typeof Error !== "undefined") {
                throw new Error(message);
            }
            throw message; // Fallback
        }
    }
    static EJSONcast(theObject) {
        return theObject;
    }
}
this.VideoApp = VideoApp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzRsb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJDNGxvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrREFBK0Q7QUFDL0QsMkRBQTJEO0FBTzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUVyQztJQVFJLE9BQWMsS0FBSztRQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNELE9BQWUsVUFBVTtRQUNyQixJQUFJLEdBQUcsR0FBUyxJQUFJLEtBQUssRUFBRSxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNELE9BQWMsU0FBUyxDQUFDLFNBQVM7UUFDN0Isa0RBQWtEO0lBQ3RELENBQUM7SUFDRCxPQUFjLHVCQUF1QixDQUFDLEdBQVUsRUFBRSxHQUFVLEVBQUUsSUFBVyxFQUFFLEdBQVUsRUFBRSxLQUFZO1FBRS9GLElBQUksS0FBSyxHQUFHLENBQUMsR0FBRyxHQUFHLEVBQUUsR0FBRyxZQUFZLEdBQUcsR0FBRyxDQUFDO1FBQzNDLEtBQUssSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLEdBQUcsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUUzQyxJQUFJLE9BQU8sR0FBRyxTQUFTLEdBQUcsR0FBRyxHQUFHLFdBQVcsR0FBRyxHQUFHLEdBQUcsYUFBYSxHQUFHLElBQUksR0FBRyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRTFGLEtBQUssQ0FBQyxRQUFRLENBQUM7WUFDWCxLQUFLLEVBQUUsMkJBQTJCO1lBQ2xDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUM7WUFDekIsSUFBSSxFQUFFLE9BQU87WUFDYixLQUFLLEVBQUUsT0FBTztTQUNqQixDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUU7WUFDckIsR0FBRyxFQUFFLEdBQUc7WUFDUixHQUFHLEVBQUUsR0FB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QUM7Z0JBQy9CLE1BQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0IsQ0FBQztZQUNELE1BQU0sT0FBTyxDQUFDLENBQUMsV0FBVztRQUM5QixDQUFDO0lBQ0wsQ0FBQztJQUNELE9BQWMsU0FBUyxDQUFDLFNBQVM7UUFFN0IsTUFBTSxDQUFTLFNBQVMsQ0FBQztJQUM3QixDQUFDO0FBQ0wsQ0FBQztBQUFBLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGVzY3JpcHQtZGVmcy9hbGwtZGVmaW5pdGlvbnMuZC50c1wiLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGVzY3JpcHQtZGVmcy9zdGFjay10cmFjZS5kLnRzXCIvPlxyXG5cclxuZGVjbGFyZSB2YXIgQzRsb2dEQjpNb25nby5Db2xsZWN0aW9uPGFueT5cclxuZGVjbGFyZSB2YXIgU3RhY2tGcmFtZTphbnk7XHJcbmRlY2xhcmUgdmFyIFN0YWNrVHJhY2VHUFM6YW55O1xyXG5kZWNsYXJlIHZhciBTdGFja1RyYWNlOmFueTtcclxuXHJcbmNvbnNvbGUubG9nKFwiTG9hZGluZyBBcHBMb2cudHMgLi4uXCIpO1xyXG5cclxuY2xhc3MgQXBwTG9nIHtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGluZm9SZXBvcnQ6Ym9vbGVhbiA9IHRydWU7XHJcbiAgICBwdWJsaWMgc3RhdGljIG5vREI6Ym9vbGVhbiA9IHRydWU7XHJcbiAgICBwdWJsaWMgc3RhdGljIGVycm9yT25seURCOmJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHVibGljIHN0YXRpYyBwcmludE9iamVjdHM6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHVibGljIHN0YXRpYyBpbml0aWFsaXplOmJvb2xlYW4gPSBBcHBMb2cuc3RhcnQoKTtcclxuICAgIHB1YmxpYyBzdGF0aWMgZ3BzID0gZmFsc2U7XHJcbiAgICBwdWJsaWMgc3RhdGljIHN0YXJ0KCk6Ym9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljICBzdGFja1RyYWNlKCk6QXJyYXk8YW55PiB7XHJcbiAgICAgICAgdmFyIGVycjpFcnJvciA9IG5ldyBFcnJvcigpO1xyXG4gICAgICAgIHJldHVybiBlcnJbXCJzdGFja1wiXTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgcHJpbnRUaGlzKHRoZU9iamVjdCkge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhlT2JqZWN0LCBudWxsLCA3KSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGRlZmF1bHRFeGNlcHRpb25IYW5kbGVyKG1zZzpzdHJpbmcsIHVybDpzdHJpbmcsIGxpbmU6bnVtYmVyLCBjb2w6bnVtYmVyLCBlcnJvcj86RXJyb3IpIDogdm9pZCB7XHJcblxyXG4gICAgICAgIHZhciBleHRyYSA9ICFjb2wgPyAnJyA6ICdcXG5jb2x1bW46ICcgKyBjb2w7XHJcbiAgICAgICAgZXh0cmEgKz0gIWVycm9yID8gJycgOiAnXFxuZXJyb3I6ICcgKyBlcnJvcjtcclxuXHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIkVycm9yOiBcIiArIG1zZyArIFwiPGJyPiB1cmw6XCIgKyB1cmwgKyBcIjxicj4gbmxpbmU6XCIgKyBsaW5lICsgXCI8YnI+XCIgKyBleHRyYTtcclxuXHJcbiAgICAgICAgd2ViaXgubW9kYWxib3goe1xyXG4gICAgICAgICAgICB0aXRsZTogXCJVbmNhdWdodCBFeGNlcHRpb24gRWVycm9yXCIsXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcIm9rXCIsIFwiTm90IE9LXCJdLFxyXG4gICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxyXG4gICAgICAgICAgICB3aWR0aDogXCI4MDBweFwiLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBBcHBMb2cuZXJyb3IobXNnLCBlcnJvciwge1xyXG4gICAgICAgICAgICBtc2c6IG1zZyxcclxuICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgIGxpbmU6IGxpbmUsXHJcbiAgICAgICAgICAgIGNvbDogY29sLFxyXG4gICAgICAgICAgICBlcnJvcjogY29sXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgdmFyIHN1cHByZXNzRXJyb3JBbGVydCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIHJlY29yZChtZXNzYWdlLCBlcnJvciwgb2JqZWN0KSB7XHJcbiAgICAgICAgQXBwTG9nLmxvZyhcInJlY29yZFwiLCBtZXNzYWdlLCBlcnJvciwgb2JqZWN0LCB0cnVlKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgZXJyb3IobWVzc2FnZSwgZXJyb3I/LCBvYmplY3Q/KSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICBVSS5FcnJvcihtZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgQXBwTG9nLmxvZyhcImVycm9yXCIsIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QpO1xyXG4gICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBpbmZvKG1lc3NhZ2UsIGVycm9yPywgb2JqZWN0Pykge1xyXG5cclxuICAgICAgICBpZiAoQXBwTG9nLmluZm9SZXBvcnQpIEFwcExvZy5sb2coXCJpbmZvXCIsIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBHUFNSZXR1cm4ocmVzdWx0KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkdQU1JldHVyblwiKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKHJlc3VsdCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIEdQU1JldHVybkVycm9yKHJlc3VsdCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJHUFNSZXR1cm4gRXJyb3JcIik7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yXCIpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0KTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgQ3JlYXRlR29vZFN0YWNrKHN0YWNrKSB7XHJcblxyXG5cclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RhY2tUcmFjZVwiKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKHN0YWNrKTtcclxuXHJcbiAgICAgICAgdmFyIHN0YWNrRnJhbWUgPSBuZXcgU3RhY2tGcmFtZShzdGFja1swXS5mdW5jdGlvbk5hbWUsIFtdLCBzdGFja1swXS5maWxlTmFtZSwgc3RhY2tbMF0ubGluZU51bWJlciwgc3RhY2tbMF0uY29sdW1uTnVtYmVyKVxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIEFwcExvZy5ncHMuZ2V0TWFwcGVkTG9jYXRpb24oc3RhY2tGcmFtZSkudGhlbihcclxuICAgICAgICAgQXBwTG9nLkdQU1JldHVybixcclxuICAgICAgICAgQXBwTG9nLkdQU1JldHVybkVycm9yKTtcclxuXHJcblxyXG4gICAgICAgICBBcHBMb2cuZ3BzLmdldE1hcHBlZExvY2F0aW9uKHN0YWNrWzBdKS50aGVuKFxyXG4gICAgICAgICBBcHBMb2cuR1BTUmV0dXJuLFxyXG4gICAgICAgICBBcHBMb2cuR1BTUmV0dXJuRXJyb3IpO1xyXG4gICAgICAgICAqL1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBsb2codHlwZTpzdHJpbmcsIG1lc3NhZ2U6c3RyaW5nLCBlcnJvcj86RXJyb3IsIG9iamVjdD86YW55LCBkYXRhYmFzZTpib29sZWFuID0gZmFsc2UpIHtcclxuXHJcbiAgICAgICAgLy8gdmFyIGNhbGxlciA9IGFyZ3VtZW50cy5jYWxsZWUuY2FsbGVyLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgIC8vIGlmICghQXBwTG9nLmdwcykge1xyXG4gICAgICAgIC8vICAgIEFwcExvZy5ncHMgPSBuZXcgU3RhY2tUcmFjZUdQUygpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgdmFyIHRoZVN0YWNrID0gZXJyb3JbXCJzdGFja1wiXTtcclxuXHJcbiAgICAgICAgICAgIC8vIFN0YWNrVHJhY2UuZnJvbUVycm9yKGVycm9yKS50aGVuKFxyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIGZ1bmN0aW9uKHN0YWNrKSB7QXBwTG9nLkNyZWF0ZUdvb2RTdGFjayhzdGFjayk7fSk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gdmFyIHRoZVN0YWNrID0gU3RhY2tUcmFjZS5wcmludFN0YWNrVHJhY2UoKTtcclxuICAgICAgICAgICAgLy92YXIgdGhlU3RhY2sgPSBBcHBMb2cuU3RhY2tUb1N0cmluZyh0aGVTdGFjayk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoZVN0YWNrID0gXCJcIjtcclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT0gXCJpbmZvXCIgJiYgIUFwcExvZy5pbmZvKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IHR5cGUgKyBcIiBcIiArIG1lc3NhZ2UgKyBcIiBcIiArIGVycm9yO1xyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICBpZiAod2luZG93KSB7XHJcbiAgICAgICAgIHZhciB0aGVOYXZpZ2F0b3IgPSBuYXZpZ2F0b3JcclxuICAgICAgICAgfVxyXG4gICAgICAgICBlbHNlIHRoZU5hdmlnYXRvciA9IG51bGw7XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIHRoZU5hdmlnYXRvciA9IG51bGw7XHJcblxyXG4gICAgICAgIGlmICghQXBwTG9nLm5vREIpXHJcbiAgICAgICAgICAgIEFwcExvZy5BZGQodHlwZSwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCwgdGhlU3RhY2ssIHRoZU5hdmlnYXRvcik7XHJcbiAgICAgICAgZWxzZSBpZiAoKEFwcExvZy5lcnJvck9ubHlEQiAmJiB0eXBlID09IFwiZXJyb3JcIikgfHwgZGF0YWJhc2UpXHJcbiAgICAgICAgICAgIEFwcExvZy5BZGQodHlwZSwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCwgdGhlU3RhY2ssIHRoZU5hdmlnYXRvcik7XHJcblxyXG4gICAgICAgIC8vY29uc29sZS5lcnJvcihcIk5hdmlnYXRvciA6IFwiKyBBcHBMb2cucHJldHR5UHJpbnQodGhlTmF2aWdhdG9yKSk7XHJcbiAgICAgICAgLy9jb25zb2xlLmVycm9yKFwiQ2FsbGVyIDogXCIgKyBjYWxsZXIpXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihkZXNjcmlwdGlvbik7XHJcbiAgICAgICAgaWYgKHR5cGUgPT0gXCJlcnJvclwiKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKEFwcExvZy5wcmV0dHlQcmludCh0aGVTdGFjaykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JqZWN0KVxyXG4gICAgICAgICAgICBpZiAoQXBwTG9nLnByaW50T2JqZWN0cylcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoQXBwTG9nLnByZXR0eVByaW50KG9iamVjdCkpO1xyXG5cclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgU3RhY2tUb1N0cmluZyh0aGVTdGFjazpBcnJheTxhbnk+KTpzdHJpbmcge1xyXG5cclxuICAgICAgICB2YXIgdGhlU3RyaW5nID0gXCJcIjtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaXRlbSBpbiB0aGVTdGFjaykge1xyXG4gICAgICAgICAgICB0aGVTdHJpbmcgKz0gdGhlU3RhY2tbaXRlbV0gKyBcIlxcblwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhlU3RyaW5nO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBQcmludE9iamVjdChvYmplY3Q6YW55KTpzdHJpbmcge1xyXG5cclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqZWN0LCBudWxsLCA0KTtcclxuXHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBjYXN0KHRoZU9iamVjdDphbnkpOkVKU09OIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIDxFSlNPTj4gdGhlT2JqZWN0O1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBNYWtlSlNPTihvYmplY3Q6YW55KTphbnkge1xyXG5cclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoSlNPTi5kZWN5Y2xlKG9iamVjdCksIG51bGwsIDQpO1xyXG5cclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgQWRkKHR5cGUsIG1lc3NhZ2UsIGVycm9yPywgb2JqZWN0PywgY2FsbGVyPywgYnJvd3Nlcj8pIHtcclxuXHJcbiAgICAgICAgdmFyIHRoZURlc2NyaXB0aW9uID0gdHlwZSArIFwiIFwiICsgbWVzc2FnZSArIFwiIFwiICsgZXJyb3I7XHJcblxyXG4gICAgICAgIHZhciBvYmplY3RBcnJheSA9IG5ldyBBcnJheTxPYmplY3Q+KCk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBlcnJvcjtcclxuICAgICAgICAgICAgICAgIHZhciBlcnJvckpzb24gPSBBcHBMb2cuTWFrZUpTT04ob2JqZWN0QXJyYXkpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gXCJObyBFcnJvclwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9ySnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIC8vaWdub3JlIGFuZCBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKG9iamVjdCkge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBvYmplY3Q7XHJcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0SnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBcIk5vIE9iamVjdFwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9iamVjdEpzb24gPSBBcHBMb2cuTWFrZUpTT04ob2JqZWN0QXJyYXkpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChicm93c2VyKSB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IGJyb3dzZXI7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnJvd3Nlckpzb24gPSBBcHBMb2cuTWFrZUpTT04oKG9iamVjdEFycmF5KSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IFwiTm8gT2JqZWN0XCI7XHJcbiAgICAgICAgICAgICAgICBicm93c2VySnNvbiA9IEFwcExvZy5NYWtlSlNPTigob2JqZWN0QXJyYXkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIEM0bG9nREIuaW5zZXJ0KHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoZURlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgZXJyb3JPYmplY3Q6IGVycm9ySnNvbixcclxuICAgICAgICAgICAgICAgIG9iamVjdDogb2JqZWN0SnNvbixcclxuICAgICAgICAgICAgICAgIGNhbGxlcjogY2FsbGVyLFxyXG4gICAgICAgICAgICAgICAgYnJvd3NlcjogYnJvd3Nlckpzb25cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIExvZ2dpbmcgQzQgRXJyb3IgaW4gREJcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBwcmV0dHlQcmludChvYmo6YW55LCBpbmRlbnQgPSAwKSB7XHJcblxyXG4gICAgICAgIGlmICghb2JqKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJudWxsXCI7XHJcblxyXG4gICAgICAgIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsXHJcbiAgICAgICAgICAgIG5ld0xpbmUgPSBcIjxicj5cIiwgc3BhY2UgPSBcIiZuYnNwO1wiLCB0YWIgPSA4LFxyXG4gICAgICAgICAgICBidWZmZXIgPSBcIlwiLFxyXG4gICAgICAgIC8vU2Vjb25kIGFyZ3VtZW50IGlzIGluZGVudFxyXG4gICAgICAgIC8vRm9yIGJldHRlciBwZXJmb3JtYW5jZSwgQ2FjaGUgaW5kZW50U3RyIGZvciBhIGdpdmVuIGluZGVudC5cclxuICAgICAgICAgICAgaW5kZW50U3RyID0gKGZ1bmN0aW9uIChuKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChuLS0pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gc3BhY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgICAgICAgICB9KShpbmRlbnQpO1xyXG5cclxuICAgICAgICBpZiAoIW9iaiB8fCAoIHR5cGVvZiBvYmogIT0gXCJvYmplY3RcIiAmJiB0eXBlb2Ygb2JqICE9IFwiZnVuY3Rpb25cIiApKSB7XHJcbiAgICAgICAgICAgIC8vYW55IG5vbi1vYmplY3QgKCBCb29sZWFuLCBTdHJpbmcsIE51bWJlciksIG51bGwsIHVuZGVmaW5lZCwgTmFOXHJcbiAgICAgICAgICAgIGJ1ZmZlciArPSBvYmo7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b1N0cmluZy5jYWxsKG9iaikgPT0gXCJbb2JqZWN0IERhdGVdXCIpIHtcclxuICAgICAgICAgICAgYnVmZmVyICs9IFwiW0RhdGVdIFwiICsgb2JqO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBSZWdFeHBcIikge1xyXG4gICAgICAgICAgICBidWZmZXIgKz0gXCJbUmVnRXhwXSBcIiArIG9iajtcclxuICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgRnVuY3Rpb25dXCIpIHtcclxuICAgICAgICAgICAgYnVmZmVyICs9IFwiW0Z1bmN0aW9uXSBcIiArIG9iajtcclxuICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgQXJyYXldXCIpIHtcclxuICAgICAgICAgICAgdmFyIGlkeCA9IDAsIGxlbiA9IG9iai5sZW5ndGg7XHJcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIltcIiArIG5ld0xpbmU7XHJcbiAgICAgICAgICAgIHdoaWxlIChpZHggPCBsZW4pIHtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50U3RyLCBpZHgsIFwiOiBcIixcclxuICAgICAgICAgICAgICAgICAgICBBcHBMb2cucHJldHR5UHJpbnQob2JqW2lkeF0sIGluZGVudCArIHRhYilcclxuICAgICAgICAgICAgICAgIF0uam9pbihcIlwiKTtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBcIjxicj5cIjtcclxuICAgICAgICAgICAgICAgIGlkeCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJ1ZmZlciArPSBpbmRlbnRTdHIgKyBcIl1cIjtcclxuICAgICAgICB9IGVsc2UgeyAvL0hhbmRsZSBPYmplY3RcclxuICAgICAgICAgICAgdmFyIHByb3A7XHJcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIntcIiArIG5ld0xpbmU7XHJcbiAgICAgICAgICAgIGZvciAocHJvcCBpbiBvYmopIHtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50U3RyLCBwcm9wLCBcIjogXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgQXBwTG9nLnByZXR0eVByaW50KG9ialtwcm9wXSwgaW5kZW50ICsgdGFiKVxyXG4gICAgICAgICAgICAgICAgXS5qb2luKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IG5ld0xpbmU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnVmZmVyICs9IGluZGVudFN0ciArIFwifVwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGJ1ZmZlcjtcclxuICAgIH1cclxufSB0aGlzLkFwcExvZyA9IEFwcExvZztcclxuXHJcbnRoaXMuam9iTG9nZ2VyID0gZnVuY3Rpb24gKG9wdHMpIHtcclxuICAgIEFwcExvZy5pbmZvKFwiSm9iIExvZ2dlciBNZXNzYWdlIDogXCIgKyBvcHRzLm1lc3NhZ2UgKyBcIiBMZXZlbCA6IFwiICsgb3B0cy5sZXZlbCwgbmV3IEVycm9yKCksIHtcclxuICAgICAgICBsZXZlbDogb3B0cy5sZXZlbCxcclxuICAgICAgICBtZXNzYWdlOiBvcHRzLm1lc3NhZ2UsXHJcbiAgICAgICAgdGFnczogb3B0cy50YWdcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGFzcyBWaWRlb0FwcCB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UsIGVycm9yPzpFcnJvciwgb2JqZWN0PzphbnkpIHtcclxuICAgICAgICBpZiAoIWNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBBcHBMb2cuZXJyb3IoXCJBc3NlcnRpb24gXCIgKyBtZXNzYWdlLCBlcnJvciwgb2JqZWN0KTtcclxuICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlIHx8IFwiQXNzZXJ0aW9uIGZhaWxlZFwiO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIEVycm9yICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhyb3cgbWVzc2FnZTsgLy8gRmFsbGJhY2tcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIEVKU09OY2FzdCh0aGVPYmplY3QpOkVKU09OIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIDxFSlNPTj4gdGhlT2JqZWN0O1xyXG4gICAgfVxyXG59dGhpcy5WaWRlb0FwcCA9IFZpZGVvQXBwO1xyXG5cclxuXHJcbiJdfQ==