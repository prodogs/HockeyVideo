/// <reference path="../typescript-defs/all-definitions.d.ts"/>
/// <reference path="../typescript-defs/stack-trace.d.ts"/>
console.log("Loading AppLog.ts ...");
var AppLog = (function () {
    function AppLog() {
    }
    AppLog.start = function () {
        return true;
    };
    AppLog.stackTrace = function () {
        var err = new Error();
        return err["stack"];
    };
    AppLog.printThis = function (theObject) {
        console.log(JSON.stringify(theObject, null, 7));
    };
    AppLog.defaultExceptionHandler = function (msg, url, line, col, error) {
        var extra = !col ? '' : '\ncolumn: ' + col;
        extra += !error ? '' : '\nerror: ' + error;
        var message = "Error: " + msg + "<br> url:" + url + "<br> nline:" + line + "<br>" + extra;
        webix.modalbox({
            title: "Uncaught Exception Eerror",
            buttons: ["ok", "Not OK"],
            text: message,
            width: "800px",
        });
        AppLog.error(msg, error, {
            msg: msg,
            url: url,
            line: line,
            col: col,
            error: col
        });
        var suppressErrorAlert = true;
    };
    AppLog.record = function (message, error, object) {
        AppLog.log("record", message, error, object, true);
    };
    AppLog.error = function (message, error, object) {
        if (typeof window != "undefined") {
            UI.Error(message);
        }
        AppLog.log("error", message, error, object);
        debugger;
    };
    AppLog.info = function (message, error, object) {
        if (AppLog.infoReport)
            AppLog.log("info", message, error, object);
    };
    AppLog.GPSReturn = function (result) {
        console.error("GPSReturn");
        console.error(result);
    };
    AppLog.GPSReturnError = function (result) {
        console.error("GPSReturn Error");
        console.error("Error");
        console.error(result);
    };
    AppLog.CreateGoodStack = function (stack) {
        console.error("StackTrace");
        console.error(stack);
        var stackFrame = new StackFrame(stack[0].functionName, [], stack[0].fileName, stack[0].lineNumber, stack[0].columnNumber);
        /*
         AppLog.gps.getMappedLocation(stackFrame).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);


         AppLog.gps.getMappedLocation(stack[0]).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);
         */
    };
    AppLog.log = function (type, message, error, object, database) {
        // var caller = arguments.callee.caller.toString();
        if (database === void 0) { database = false; }
        // if (!AppLog.gps) {
        //    AppLog.gps = new StackTraceGPS();
        // }
        if (error) {
            var theStack = error["stack"];
        }
        else
            theStack = "";
        if (type == "info" && !AppLog.info)
            return;
        var description = type + " " + message + " " + error;
        /*
         if (window) {
         var theNavigator = navigator
         }
         else theNavigator = null;
         */
        var theNavigator = null;
        if (!AppLog.noDB)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        else if ((AppLog.errorOnlyDB && type == "error") || database)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        //console.error("Navigator : "+ AppLog.prettyPrint(theNavigator));
        //console.error("Caller : " + caller)
        console.error(description);
        if (type == "error") {
            console.error(error);
            console.error(AppLog.prettyPrint(theStack));
        }
        if (object)
            if (AppLog.printObjects)
                console.error(AppLog.prettyPrint(object));
    };
    AppLog.StackToString = function (theStack) {
        var theString = "";
        for (var item in theStack) {
            theString += theStack[item] + "\n";
        }
        return theString;
    };
    AppLog.PrintObject = function (object) {
        return JSON.stringify(object, null, 4);
    };
    AppLog.cast = function (theObject) {
        return theObject;
    };
    AppLog.MakeJSON = function (object) {
        return JSON.stringify(JSON.decycle(object), null, 4);
    };
    AppLog.Add = function (type, message, error, object, caller, browser) {
        var theDescription = type + " " + message + " " + error;
        var objectArray = new Array();
        try {
            if (error) {
                objectArray[0] = error;
                var errorJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Error";
                var errorJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (object) {
                objectArray[0] = object;
                var objectJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Object";
                var objectJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (browser) {
                objectArray[0] = browser;
                var browserJson = AppLog.MakeJSON((objectArray));
            }
            else {
                objectArray[0] = "No Object";
                browserJson = AppLog.MakeJSON((objectArray));
            }
        }
        catch (e) {
        }
        try {
            C4logDB.insert({
                type: type,
                message: message,
                description: theDescription,
                errorObject: errorJson,
                object: objectJson,
                caller: caller,
                browser: browserJson
            });
        }
        catch (e) {
            console.log("Error Logging C4 Error in DB");
            return;
        }
    };
    AppLog.prettyPrint = function (obj, indent) {
        if (indent === void 0) { indent = 0; }
        if (!obj)
            return "null";
        var toString = Object.prototype.toString, newLine = "<br>", space = "&nbsp;", tab = 8, buffer = "", 
        //Second argument is indent
        //For better performance, Cache indentStr for a given indent.
        indentStr = (function (n) {
            var str = "";
            while (n--) {
                str += space;
            }
            return str;
        })(indent);
        if (!obj || (typeof obj != "object" && typeof obj != "function")) {
            //any non-object ( Boolean, String, Number), null, undefined, NaN
            buffer += obj;
        }
        else if (toString.call(obj) == "[object Date]") {
            buffer += "[Date] " + obj;
        }
        else if (toString.call(obj) == "[object RegExp") {
            buffer += "[RegExp] " + obj;
        }
        else if (toString.call(obj) == "[object Function]") {
            buffer += "[Function] " + obj;
        }
        else if (toString.call(obj) == "[object Array]") {
            var idx = 0, len = obj.length;
            buffer += "[" + newLine;
            while (idx < len) {
                buffer += [
                    indentStr, idx, ": ",
                    AppLog.prettyPrint(obj[idx], indent + tab)
                ].join("");
                buffer += "<br>";
                idx++;
            }
            buffer += indentStr + "]";
        }
        else {
            var prop;
            buffer += "{" + newLine;
            for (prop in obj) {
                buffer += [
                    indentStr, prop, ": ",
                    AppLog.prettyPrint(obj[prop], indent + tab)
                ].join("");
                buffer += newLine;
            }
            buffer += indentStr + "}";
        }
        return buffer;
    };
    AppLog.infoReport = true;
    AppLog.noDB = true;
    AppLog.errorOnlyDB = true;
    AppLog.printObjects = false;
    AppLog.initialize = AppLog.start();
    AppLog.gps = false;
    return AppLog;
}());
this.AppLog = AppLog;
this.jobLogger = function (opts) {
    AppLog.info("Job Logger Message : " + opts.message + " Level : " + opts.level, new Error(), {
        level: opts.level,
        message: opts.message,
        tags: opts.tag
    });
};
var VideoApp = (function () {
    function VideoApp() {
    }
    VideoApp.assert = function (condition, message, error, object) {
        if (!condition) {
            AppLog.error("Assertion " + message, error, object);
            debugger;
            message = message || "Assertion failed";
            if (typeof Error !== "undefined") {
                throw new Error(message);
            }
            throw message; // Fallback
        }
    };
    VideoApp.EJSONcast = function (theObject) {
        return theObject;
    };
    return VideoApp;
}());
this.VideoApp = VideoApp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzRsb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJDNGxvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrREFBK0Q7QUFDL0QsMkRBQTJEO0FBTzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUVyQztJQUFBO0lBa1JBLENBQUM7SUExUWlCLFlBQUssR0FBbkI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDYyxpQkFBVSxHQUF6QjtRQUNJLElBQUksR0FBRyxHQUFTLElBQUksS0FBSyxFQUFFLENBQUM7UUFDNUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBQ2EsZ0JBQVMsR0FBdkIsVUFBd0IsU0FBUztRQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFDYSw4QkFBdUIsR0FBckMsVUFBc0MsR0FBVSxFQUFFLEdBQVUsRUFBRSxJQUFXLEVBQUUsR0FBVSxFQUFFLEtBQVk7UUFFL0YsSUFBSSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEdBQUcsRUFBRSxHQUFHLFlBQVksR0FBRyxHQUFHLENBQUM7UUFDM0MsS0FBSyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsR0FBRyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBRTNDLElBQUksT0FBTyxHQUFHLFNBQVMsR0FBRyxHQUFHLEdBQUcsV0FBVyxHQUFHLEdBQUcsR0FBRyxhQUFhLEdBQUcsSUFBSSxHQUFHLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFFMUYsS0FBSyxDQUFDLFFBQVEsQ0FBQztZQUNYLEtBQUssRUFBRSwyQkFBMkI7WUFDbEMsT0FBTyxFQUFFLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQztZQUN6QixJQUFJLEVBQUUsT0FBTztZQUNiLEtBQUssRUFBRSxPQUFPO1NB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QyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2IsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNwRCxRQUFRLENBQUM7WUFDVCxPQUFPLEdBQUcsT0FBTyxJQUFJLGtCQUFrQixDQUFDO1lBQ3hDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sS0FBSyxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUM7Z0JBQy9CLE1BQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0IsQ0FBQztZQUNELE1BQU0sT0FBTyxDQUFDLENBQUMsV0FBVztRQUM5QixDQUFDO0lBQ0wsQ0FBQztJQUNhLGtCQUFTLEdBQXZCLFVBQXdCLFNBQVM7UUFFN0IsTUFBTSxDQUFTLFNBQVMsQ0FBQztJQUM3QixDQUFDO0lBQ0wsZUFBQztBQUFELENBQUMsQUFoQkQsSUFnQkM7QUFBQSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBlc2NyaXB0LWRlZnMvYWxsLWRlZmluaXRpb25zLmQudHNcIi8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBlc2NyaXB0LWRlZnMvc3RhY2stdHJhY2UuZC50c1wiLz5cclxuXHJcbmRlY2xhcmUgdmFyIEM0bG9nREI6TW9uZ28uQ29sbGVjdGlvbjxhbnk+XHJcbmRlY2xhcmUgdmFyIFN0YWNrRnJhbWU6YW55O1xyXG5kZWNsYXJlIHZhciBTdGFja1RyYWNlR1BTOmFueTtcclxuZGVjbGFyZSB2YXIgU3RhY2tUcmFjZTphbnk7XHJcblxyXG5jb25zb2xlLmxvZyhcIkxvYWRpbmcgQXBwTG9nLnRzIC4uLlwiKTtcclxuXHJcbmNsYXNzIEFwcExvZyB7XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpbmZvUmVwb3J0OmJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHVibGljIHN0YXRpYyBub0RCOmJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHVibGljIHN0YXRpYyBlcnJvck9ubHlEQjpib29sZWFuID0gdHJ1ZTtcclxuICAgIHB1YmxpYyBzdGF0aWMgcHJpbnRPYmplY3RzOmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHB1YmxpYyBzdGF0aWMgaW5pdGlhbGl6ZTpib29sZWFuID0gQXBwTG9nLnN0YXJ0KCk7XHJcbiAgICBwdWJsaWMgc3RhdGljIGdwcyA9IGZhbHNlO1xyXG4gICAgcHVibGljIHN0YXRpYyBzdGFydCgpOmJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyAgc3RhY2tUcmFjZSgpOkFycmF5PGFueT4ge1xyXG4gICAgICAgIHZhciBlcnI6RXJyb3IgPSBuZXcgRXJyb3IoKTtcclxuICAgICAgICByZXR1cm4gZXJyW1wic3RhY2tcIl07XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIHByaW50VGhpcyh0aGVPYmplY3QpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGVPYmplY3QsIG51bGwsIDcpKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgZGVmYXVsdEV4Y2VwdGlvbkhhbmRsZXIobXNnOnN0cmluZywgdXJsOnN0cmluZywgbGluZTpudW1iZXIsIGNvbDpudW1iZXIsIGVycm9yPzpFcnJvcikgOiB2b2lkIHtcclxuXHJcbiAgICAgICAgdmFyIGV4dHJhID0gIWNvbCA/ICcnIDogJ1xcbmNvbHVtbjogJyArIGNvbDtcclxuICAgICAgICBleHRyYSArPSAhZXJyb3IgPyAnJyA6ICdcXG5lcnJvcjogJyArIGVycm9yO1xyXG5cclxuICAgICAgICB2YXIgbWVzc2FnZSA9IFwiRXJyb3I6IFwiICsgbXNnICsgXCI8YnI+IHVybDpcIiArIHVybCArIFwiPGJyPiBubGluZTpcIiArIGxpbmUgKyBcIjxicj5cIiArIGV4dHJhO1xyXG5cclxuICAgICAgICB3ZWJpeC5tb2RhbGJveCh7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIlVuY2F1Z2h0IEV4Y2VwdGlvbiBFZXJyb3JcIixcclxuICAgICAgICAgICAgYnV0dG9uczogW1wib2tcIiwgXCJOb3QgT0tcIl0sXHJcbiAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjgwMHB4XCIsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIEFwcExvZy5lcnJvcihtc2csIGVycm9yLCB7XHJcbiAgICAgICAgICAgIG1zZzogbXNnLFxyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgbGluZTogbGluZSxcclxuICAgICAgICAgICAgY29sOiBjb2wsXHJcbiAgICAgICAgICAgIGVycm9yOiBjb2xcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICB2YXIgc3VwcHJlc3NFcnJvckFsZXJ0ID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgcmVjb3JkKG1lc3NhZ2UsIGVycm9yLCBvYmplY3QpIHtcclxuICAgICAgICBBcHBMb2cubG9nKFwicmVjb3JkXCIsIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBlcnJvcihtZXNzYWdlLCBlcnJvcj8sIG9iamVjdD8pIHtcclxuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgIFVJLkVycm9yKG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBBcHBMb2cubG9nKFwiZXJyb3JcIiwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCk7XHJcbiAgICAgICAgZGVidWdnZXI7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGluZm8obWVzc2FnZSwgZXJyb3I/LCBvYmplY3Q/KSB7XHJcblxyXG4gICAgICAgIGlmIChBcHBMb2cuaW5mb1JlcG9ydCkgQXBwTG9nLmxvZyhcImluZm9cIiwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIEdQU1JldHVybihyZXN1bHQpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiR1BTUmV0dXJuXCIpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0KTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgR1BTUmV0dXJuRXJyb3IocmVzdWx0KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkdQU1JldHVybiBFcnJvclwiKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3JcIik7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihyZXN1bHQpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBDcmVhdGVHb29kU3RhY2soc3RhY2spIHtcclxuXHJcblxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTdGFja1RyYWNlXCIpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3Ioc3RhY2spO1xyXG5cclxuICAgICAgICB2YXIgc3RhY2tGcmFtZSA9IG5ldyBTdGFja0ZyYW1lKHN0YWNrWzBdLmZ1bmN0aW9uTmFtZSwgW10sIHN0YWNrWzBdLmZpbGVOYW1lLCBzdGFja1swXS5saW5lTnVtYmVyLCBzdGFja1swXS5jb2x1bW5OdW1iZXIpXHJcbiAgICAgICAgLypcclxuICAgICAgICAgQXBwTG9nLmdwcy5nZXRNYXBwZWRMb2NhdGlvbihzdGFja0ZyYW1lKS50aGVuKFxyXG4gICAgICAgICBBcHBMb2cuR1BTUmV0dXJuLFxyXG4gICAgICAgICBBcHBMb2cuR1BTUmV0dXJuRXJyb3IpO1xyXG5cclxuXHJcbiAgICAgICAgIEFwcExvZy5ncHMuZ2V0TWFwcGVkTG9jYXRpb24oc3RhY2tbMF0pLnRoZW4oXHJcbiAgICAgICAgIEFwcExvZy5HUFNSZXR1cm4sXHJcbiAgICAgICAgIEFwcExvZy5HUFNSZXR1cm5FcnJvcik7XHJcbiAgICAgICAgICovXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGxvZyh0eXBlOnN0cmluZywgbWVzc2FnZTpzdHJpbmcsIGVycm9yPzpFcnJvciwgb2JqZWN0PzphbnksIGRhdGFiYXNlOmJvb2xlYW4gPSBmYWxzZSkge1xyXG5cclxuICAgICAgICAvLyB2YXIgY2FsbGVyID0gYXJndW1lbnRzLmNhbGxlZS5jYWxsZXIudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgLy8gaWYgKCFBcHBMb2cuZ3BzKSB7XHJcbiAgICAgICAgLy8gICAgQXBwTG9nLmdwcyA9IG5ldyBTdGFja1RyYWNlR1BTKCk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICB2YXIgdGhlU3RhY2sgPSBlcnJvcltcInN0YWNrXCJdO1xyXG5cclxuICAgICAgICAgICAgLy8gU3RhY2tUcmFjZS5mcm9tRXJyb3IoZXJyb3IpLnRoZW4oXHJcblxyXG5cclxuICAgICAgICAgICAgLy8gZnVuY3Rpb24oc3RhY2spIHtBcHBMb2cuQ3JlYXRlR29vZFN0YWNrKHN0YWNrKTt9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyB2YXIgdGhlU3RhY2sgPSBTdGFja1RyYWNlLnByaW50U3RhY2tUcmFjZSgpO1xyXG4gICAgICAgICAgICAvL3ZhciB0aGVTdGFjayA9IEFwcExvZy5TdGFja1RvU3RyaW5nKHRoZVN0YWNrKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhlU3RhY2sgPSBcIlwiO1xyXG5cclxuICAgICAgICBpZiAodHlwZSA9PSBcImluZm9cIiAmJiAhQXBwTG9nLmluZm8pXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0gdHlwZSArIFwiIFwiICsgbWVzc2FnZSArIFwiIFwiICsgZXJyb3I7XHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgIGlmICh3aW5kb3cpIHtcclxuICAgICAgICAgdmFyIHRoZU5hdmlnYXRvciA9IG5hdmlnYXRvclxyXG4gICAgICAgICB9XHJcbiAgICAgICAgIGVsc2UgdGhlTmF2aWdhdG9yID0gbnVsbDtcclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgdGhlTmF2aWdhdG9yID0gbnVsbDtcclxuXHJcbiAgICAgICAgaWYgKCFBcHBMb2cubm9EQilcclxuICAgICAgICAgICAgQXBwTG9nLkFkZCh0eXBlLCBtZXNzYWdlLCBlcnJvciwgb2JqZWN0LCB0aGVTdGFjaywgdGhlTmF2aWdhdG9yKTtcclxuICAgICAgICBlbHNlIGlmICgoQXBwTG9nLmVycm9yT25seURCICYmIHR5cGUgPT0gXCJlcnJvclwiKSB8fCBkYXRhYmFzZSlcclxuICAgICAgICAgICAgQXBwTG9nLkFkZCh0eXBlLCBtZXNzYWdlLCBlcnJvciwgb2JqZWN0LCB0aGVTdGFjaywgdGhlTmF2aWdhdG9yKTtcclxuXHJcbiAgICAgICAgLy9jb25zb2xlLmVycm9yKFwiTmF2aWdhdG9yIDogXCIrIEFwcExvZy5wcmV0dHlQcmludCh0aGVOYXZpZ2F0b3IpKTtcclxuICAgICAgICAvL2NvbnNvbGUuZXJyb3IoXCJDYWxsZXIgOiBcIiArIGNhbGxlcilcclxuICAgICAgICBjb25zb2xlLmVycm9yKGRlc2NyaXB0aW9uKTtcclxuICAgICAgICBpZiAodHlwZSA9PSBcImVycm9yXCIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoQXBwTG9nLnByZXR0eVByaW50KHRoZVN0YWNrKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvYmplY3QpXHJcbiAgICAgICAgICAgIGlmIChBcHBMb2cucHJpbnRPYmplY3RzKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihBcHBMb2cucHJldHR5UHJpbnQob2JqZWN0KSk7XHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBTdGFja1RvU3RyaW5nKHRoZVN0YWNrOkFycmF5PGFueT4pOnN0cmluZyB7XHJcblxyXG4gICAgICAgIHZhciB0aGVTdHJpbmcgPSBcIlwiO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpdGVtIGluIHRoZVN0YWNrKSB7XHJcbiAgICAgICAgICAgIHRoZVN0cmluZyArPSB0aGVTdGFja1tpdGVtXSArIFwiXFxuXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGVTdHJpbmc7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIFByaW50T2JqZWN0KG9iamVjdDphbnkpOnN0cmluZyB7XHJcblxyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmplY3QsIG51bGwsIDQpO1xyXG5cclxuXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIGNhc3QodGhlT2JqZWN0OmFueSk6RUpTT04ge1xyXG5cclxuICAgICAgICByZXR1cm4gPEVKU09OPiB0aGVPYmplY3Q7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIE1ha2VKU09OKG9iamVjdDphbnkpOmFueSB7XHJcblxyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShKU09OLmRlY3ljbGUob2JqZWN0KSwgbnVsbCwgNCk7XHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIHN0YXRpYyBBZGQodHlwZSwgbWVzc2FnZSwgZXJyb3I/LCBvYmplY3Q/LCBjYWxsZXI/LCBicm93c2VyPykge1xyXG5cclxuICAgICAgICB2YXIgdGhlRGVzY3JpcHRpb24gPSB0eXBlICsgXCIgXCIgKyBtZXNzYWdlICsgXCIgXCIgKyBlcnJvcjtcclxuXHJcbiAgICAgICAgdmFyIG9iamVjdEFycmF5ID0gbmV3IEFycmF5PE9iamVjdD4oKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IGVycm9yO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9ySnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBcIk5vIEVycm9yXCI7XHJcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JKc29uID0gQXBwTG9nLk1ha2VKU09OKG9iamVjdEFycmF5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy9pZ25vcmUgYW5kIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAob2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IG9iamVjdDtcclxuICAgICAgICAgICAgICAgIHZhciBvYmplY3RKc29uID0gQXBwTG9nLk1ha2VKU09OKG9iamVjdEFycmF5KTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IFwiTm8gT2JqZWN0XCI7XHJcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0SnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGJyb3dzZXIpIHtcclxuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gYnJvd3NlcjtcclxuICAgICAgICAgICAgICAgIHZhciBicm93c2VySnNvbiA9IEFwcExvZy5NYWtlSlNPTigob2JqZWN0QXJyYXkpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gXCJObyBPYmplY3RcIjtcclxuICAgICAgICAgICAgICAgIGJyb3dzZXJKc29uID0gQXBwTG9nLk1ha2VKU09OKChvYmplY3RBcnJheSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgQzRsb2dEQi5pbnNlcnQoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhlRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICBlcnJvck9iamVjdDogZXJyb3JKc29uLFxyXG4gICAgICAgICAgICAgICAgb2JqZWN0OiBvYmplY3RKc29uLFxyXG4gICAgICAgICAgICAgICAgY2FsbGVyOiBjYWxsZXIsXHJcbiAgICAgICAgICAgICAgICBicm93c2VyOiBicm93c2VySnNvblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgTG9nZ2luZyBDNCBFcnJvciBpbiBEQlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgc3RhdGljIHByZXR0eVByaW50KG9iajphbnksIGluZGVudCA9IDApIHtcclxuXHJcbiAgICAgICAgaWYgKCFvYmopXHJcbiAgICAgICAgICAgIHJldHVybiBcIm51bGxcIjtcclxuXHJcbiAgICAgICAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxcclxuICAgICAgICAgICAgbmV3TGluZSA9IFwiPGJyPlwiLCBzcGFjZSA9IFwiJm5ic3A7XCIsIHRhYiA9IDgsXHJcbiAgICAgICAgICAgIGJ1ZmZlciA9IFwiXCIsXHJcbiAgICAgICAgLy9TZWNvbmQgYXJndW1lbnQgaXMgaW5kZW50XHJcbiAgICAgICAgLy9Gb3IgYmV0dGVyIHBlcmZvcm1hbmNlLCBDYWNoZSBpbmRlbnRTdHIgZm9yIGEgZ2l2ZW4gaW5kZW50LlxyXG4gICAgICAgICAgICBpbmRlbnRTdHIgPSAoZnVuY3Rpb24gKG4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHIgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKG4tLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0ciArPSBzcGFjZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XHJcbiAgICAgICAgICAgIH0pKGluZGVudCk7XHJcblxyXG4gICAgICAgIGlmICghb2JqIHx8ICggdHlwZW9mIG9iaiAhPSBcIm9iamVjdFwiICYmIHR5cGVvZiBvYmogIT0gXCJmdW5jdGlvblwiICkpIHtcclxuICAgICAgICAgICAgLy9hbnkgbm9uLW9iamVjdCAoIEJvb2xlYW4sIFN0cmluZywgTnVtYmVyKSwgbnVsbCwgdW5kZWZpbmVkLCBOYU5cclxuICAgICAgICAgICAgYnVmZmVyICs9IG9iajtcclxuICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgRGF0ZV1cIikge1xyXG4gICAgICAgICAgICBidWZmZXIgKz0gXCJbRGF0ZV0gXCIgKyBvYmo7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0b1N0cmluZy5jYWxsKG9iaikgPT0gXCJbb2JqZWN0IFJlZ0V4cFwiKSB7XHJcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIltSZWdFeHBdIFwiICsgb2JqO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBGdW5jdGlvbl1cIikge1xyXG4gICAgICAgICAgICBidWZmZXIgKz0gXCJbRnVuY3Rpb25dIFwiICsgb2JqO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBBcnJheV1cIikge1xyXG4gICAgICAgICAgICB2YXIgaWR4ID0gMCwgbGVuID0gb2JqLmxlbmd0aDtcclxuICAgICAgICAgICAgYnVmZmVyICs9IFwiW1wiICsgbmV3TGluZTtcclxuICAgICAgICAgICAgd2hpbGUgKGlkeCA8IGxlbikge1xyXG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IFtcclxuICAgICAgICAgICAgICAgICAgICBpbmRlbnRTdHIsIGlkeCwgXCI6IFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIEFwcExvZy5wcmV0dHlQcmludChvYmpbaWR4XSwgaW5kZW50ICsgdGFiKVxyXG4gICAgICAgICAgICAgICAgXS5qb2luKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IFwiPGJyPlwiO1xyXG4gICAgICAgICAgICAgICAgaWR4Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnVmZmVyICs9IGluZGVudFN0ciArIFwiXVwiO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vSGFuZGxlIE9iamVjdFxyXG4gICAgICAgICAgICB2YXIgcHJvcDtcclxuICAgICAgICAgICAgYnVmZmVyICs9IFwie1wiICsgbmV3TGluZTtcclxuICAgICAgICAgICAgZm9yIChwcm9wIGluIG9iaikge1xyXG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IFtcclxuICAgICAgICAgICAgICAgICAgICBpbmRlbnRTdHIsIHByb3AsIFwiOiBcIixcclxuICAgICAgICAgICAgICAgICAgICBBcHBMb2cucHJldHR5UHJpbnQob2JqW3Byb3BdLCBpbmRlbnQgKyB0YWIpXHJcbiAgICAgICAgICAgICAgICBdLmpvaW4oXCJcIik7XHJcbiAgICAgICAgICAgICAgICBidWZmZXIgKz0gbmV3TGluZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBidWZmZXIgKz0gaW5kZW50U3RyICsgXCJ9XCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYnVmZmVyO1xyXG4gICAgfVxyXG59IHRoaXMuQXBwTG9nID0gQXBwTG9nO1xyXG5cclxudGhpcy5qb2JMb2dnZXIgPSBmdW5jdGlvbiAob3B0cykge1xyXG4gICAgQXBwTG9nLmluZm8oXCJKb2IgTG9nZ2VyIE1lc3NhZ2UgOiBcIiArIG9wdHMubWVzc2FnZSArIFwiIExldmVsIDogXCIgKyBvcHRzLmxldmVsLCBuZXcgRXJyb3IoKSwge1xyXG4gICAgICAgIGxldmVsOiBvcHRzLmxldmVsLFxyXG4gICAgICAgIG1lc3NhZ2U6IG9wdHMubWVzc2FnZSxcclxuICAgICAgICB0YWdzOiBvcHRzLnRhZ1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmNsYXNzIFZpZGVvQXBwIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSwgZXJyb3I/OkVycm9yLCBvYmplY3Q/OmFueSkge1xyXG4gICAgICAgIGlmICghY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIEFwcExvZy5lcnJvcihcIkFzc2VydGlvbiBcIiArIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QpO1xyXG4gICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCI7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgRXJyb3IgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aHJvdyBtZXNzYWdlOyAvLyBGYWxsYmFja1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgRUpTT05jYXN0KHRoZU9iamVjdCk6RUpTT04ge1xyXG5cclxuICAgICAgICByZXR1cm4gPEVKU09OPiB0aGVPYmplY3Q7XHJcbiAgICB9XHJcbn10aGlzLlZpZGVvQXBwID0gVmlkZW9BcHA7XHJcblxyXG5cclxuIl19