/// <reference path="../typescript-defs/all-definitions.d.ts"/>
/// <reference path="../typescript-defs/stack-trace.d.ts"/>
console.log("Loading AppLog.ts ...");
var AppLog = (function () {
    function AppLog() {
    }
    AppLog.start = function () {
        return true;
    };
    AppLog.stackTrace = function () {
        var err = new Error();
        return err["stack"];
    };
    AppLog.printThis = function (theObject) {
        console.log(JSON.stringify(theObject, null, 7));
    };
    AppLog.defaultExceptionHandler = function (msg, url, line, col, error) {
        var extra = !col ? '' : '\ncolumn: ' + col;
        extra += !error ? '' : '\nerror: ' + error;
        var message = "Error: " + msg + "<br> url:" + url + "<br> nline:" + line + "<br>" + extra;
        webix.modalbox({
            title: "Uncaught Exception Eerror",
            buttons: ["ok", "Not OK"],
            text: message,
            width: "800px",
        });
        AppLog.error(msg, error, {
            msg: msg,
            url: url,
            line: line,
            col: col,
            error: col
        });
        var suppressErrorAlert = true;
    };
    AppLog.record = function (message, error, object) {
        AppLog.log("record", message, error, object, true);
    };
    AppLog.error = function (message, error, object) {
        if (typeof window != "undefined") {
            UI.Error(message);
        }
        AppLog.log("error", message, error, object);
        debugger;
    };
    AppLog.info = function (message, error, object) {
        if (AppLog.infoReport)
            AppLog.log("info", message, error, object);
    };
    AppLog.GPSReturn = function (result) {
        console.error("GPSReturn");
        console.error(result);
    };
    AppLog.GPSReturnError = function (result) {
        console.error("GPSReturn Error");
        console.error("Error");
        console.error(result);
    };
    AppLog.CreateGoodStack = function (stack) {
        console.error("StackTrace");
        console.error(stack);
        var stackFrame = new StackFrame(stack[0].functionName, [], stack[0].fileName, stack[0].lineNumber, stack[0].columnNumber);
        /*
         AppLog.gps.getMappedLocation(stackFrame).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);


         AppLog.gps.getMappedLocation(stack[0]).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);
         */
    };
    AppLog.log = function (type, message, error, object, database) {
        // var caller = arguments.callee.caller.toString();
        if (database === void 0) { database = false; }
        // if (!AppLog.gps) {
        //    AppLog.gps = new StackTraceGPS();
        // }
        if (error) {
            var theStack = error["stack"];
        }
        else
            theStack = "";
        if (type == "info" && !AppLog.info)
            return;
        var description = type + " " + message + " " + error;
        /*
         if (window) {
         var theNavigator = navigator
         }
         else theNavigator = null;
         */
        var theNavigator = null;
        if (!AppLog.noDB)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        else if ((AppLog.errorOnlyDB && type == "error") || database)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        //console.error("Navigator : "+ AppLog.prettyPrint(theNavigator));
        //console.error("Caller : " + caller)
        console.error(description);
        if (type == "error") {
            console.error(error);
            console.error(AppLog.prettyPrint(theStack));
        }
        if (object)
            if (AppLog.printObjects)
                console.error(AppLog.prettyPrint(object));
    };
    AppLog.StackToString = function (theStack) {
        var theString = "";
        for (var item in theStack) {
            theString += theStack[item] + "\n";
        }
        return theString;
    };
    AppLog.PrintObject = function (object) {
        return JSON.stringify(object, null, 4);
    };
    AppLog.cast = function (theObject) {
        return theObject;
    };
    AppLog.MakeJSON = function (object) {
        return JSON.stringify(JSON.decycle(object), null, 4);
    };
    AppLog.Add = function (type, message, error, object, caller, browser) {
        var theDescription = type + " " + message + " " + error;
        var objectArray = new Array();
        try {
            if (error) {
                objectArray[0] = error;
                var errorJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Error";
                var errorJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (object) {
                objectArray[0] = object;
                var objectJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Object";
                var objectJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (browser) {
                objectArray[0] = browser;
                var browserJson = AppLog.MakeJSON((objectArray));
            }
            else {
                objectArray[0] = "No Object";
                browserJson = AppLog.MakeJSON((objectArray));
            }
        }
        catch (e) {
        }
        try {
            C4logDB.insert({
                type: type,
                message: message,
                description: theDescription,
                errorObject: errorJson,
                object: objectJson,
                caller: caller,
                browser: browserJson
            });
        }
        catch (e) {
            console.log("Error Logging C4 Error in DB");
            return;
        }
    };
    AppLog.prettyPrint = function (obj, indent) {
        if (indent === void 0) { indent = 0; }
        if (!obj)
            return "null";
        var toString = Object.prototype.toString, newLine = "<br>", space = "&nbsp;", tab = 8, buffer = "", 
        //Second argument is indent
        //For better performance, Cache indentStr for a given indent.
        indentStr = (function (n) {
            var str = "";
            while (n--) {
                str += space;
            }
            return str;
        })(indent);
        if (!obj || (typeof obj != "object" && typeof obj != "function")) {
            //any non-object ( Boolean, String, Number), null, undefined, NaN
            buffer += obj;
        }
        else if (toString.call(obj) == "[object Date]") {
            buffer += "[Date] " + obj;
        }
        else if (toString.call(obj) == "[object RegExp") {
            buffer += "[RegExp] " + obj;
        }
        else if (toString.call(obj) == "[object Function]") {
            buffer += "[Function] " + obj;
        }
        else if (toString.call(obj) == "[object Array]") {
            var idx = 0, len = obj.length;
            buffer += "[" + newLine;
            while (idx < len) {
                buffer += [
                    indentStr, idx, ": ",
                    AppLog.prettyPrint(obj[idx], indent + tab)
                ].join("");
                buffer += "<br>";
                idx++;
            }
            buffer += indentStr + "]";
        }
        else {
            var prop;
            buffer += "{" + newLine;
            for (prop in obj) {
                buffer += [
                    indentStr, prop, ": ",
                    AppLog.prettyPrint(obj[prop], indent + tab)
                ].join("");
                buffer += newLine;
            }
            buffer += indentStr + "}";
        }
        return buffer;
    };
    AppLog.infoReport = true;
    AppLog.noDB = true;
    AppLog.errorOnlyDB = true;
    AppLog.printObjects = false;
    AppLog.initialize = AppLog.start();
    AppLog.gps = false;
    return AppLog;
}());
this.AppLog = AppLog;
this.jobLogger = function (opts) {
    AppLog.info("Job Logger Message : " + opts.message + " Level : " + opts.level, new Error(), {
        level: opts.level,
        message: opts.message,
        tags: opts.tag
    });
};
var VideoApp = (function () {
    function VideoApp() {
    }
    VideoApp.assert = function (condition, message, error, object) {
        if (!condition) {
            AppLog.error("Assertion " + message, error, object);
            debugger;
            message = message || "Assertion failed";
            if (typeof Error !== "undefined") {
                throw new Error(message);
            }
            throw message; // Fallback
        }
    };
    VideoApp.EJSONcast = function (theObject) {
        return theObject;
    };
    return VideoApp;
}());
this.VideoApp = VideoApp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzRsb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJDNGxvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrREFBK0Q7QUFDL0QsMkRBQTJEO0FBTzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUVyQztJQUFBO0lBa1JBLENBQUM7SUExUWlCLFlBQUssR0FBbkI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDYyxpQkFBVSxHQUF6QjtRQUNJLElBQUksR0FBRyxHQUFTLElBQUksS0FBSyxFQUFFLENBQUM7UUFDNUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBQ2EsZ0JBQVMsR0FBdkIsVUFBd0IsU0FBUztRQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFDYSw4QkFBdUIsR0FBckMsVUFBc0MsR0FBVSxFQUFFLEdBQVUsRUFBRSxJQUFXLEVBQUUsR0FBVSxFQUFFLEtBQVk7UUFFL0YsSUFBSSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEdBQUcsRUFBRSxHQUFHLFlBQVksR0FBRyxHQUFHLENBQUM7UUFDM0MsS0FBSyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsR0FBRyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBRTNDLElBQUksT0FBTyxHQUFHLFNBQVMsR0FBRyxHQUFHLEdBQUcsV0FBVyxHQUFHLEdBQUcsR0FBRyxhQUFhLEdBQUcsSUFBSSxHQUFHLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFFMUYsS0FBSyxDQUFDLFFBQVEsQ0FBQztZQUNYLEtBQUssRUFBRSwyQkFBMkI7WUFDbEMsT0FBTyxFQUFFLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQztZQUN6QixJQUFJLEVBQUUsT0FBTztZQUNiLEtBQUssRUFBRSxPQUFPO1NB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QyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2IsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNwRCxRQUFRLENBQUM7WUFDVCxPQUFPLEdBQUcsT0FBTyxJQUFJLGtCQUFrQixDQUFDO1lBQ3hDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sS0FBSyxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUM7Z0JBQy9CLE1BQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0IsQ0FBQztZQUNELE1BQU0sT0FBTyxDQUFDLENBQUMsV0FBVztRQUM5QixDQUFDO0lBQ0wsQ0FBQztJQUNhLGtCQUFTLEdBQXZCLFVBQXdCLFNBQVM7UUFFN0IsTUFBTSxDQUFTLFNBQVMsQ0FBQztJQUM3QixDQUFDO0lBQ0wsZUFBQztBQUFELENBQUMsQUFoQkQsSUFnQkM7QUFBQSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBlc2NyaXB0LWRlZnMvYWxsLWRlZmluaXRpb25zLmQudHNcIi8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwZXNjcmlwdC1kZWZzL3N0YWNrLXRyYWNlLmQudHNcIi8+XG5cbmRlY2xhcmUgdmFyIEM0bG9nREI6TW9uZ28uQ29sbGVjdGlvbjxhbnk+XG5kZWNsYXJlIHZhciBTdGFja0ZyYW1lOmFueTtcbmRlY2xhcmUgdmFyIFN0YWNrVHJhY2VHUFM6YW55O1xuZGVjbGFyZSB2YXIgU3RhY2tUcmFjZTphbnk7XG5cbmNvbnNvbGUubG9nKFwiTG9hZGluZyBBcHBMb2cudHMgLi4uXCIpO1xuXG5jbGFzcyBBcHBMb2cge1xuXG4gICAgcHVibGljIHN0YXRpYyBpbmZvUmVwb3J0OmJvb2xlYW4gPSB0cnVlO1xuICAgIHB1YmxpYyBzdGF0aWMgbm9EQjpib29sZWFuID0gdHJ1ZTtcbiAgICBwdWJsaWMgc3RhdGljIGVycm9yT25seURCOmJvb2xlYW4gPSB0cnVlO1xuICAgIHB1YmxpYyBzdGF0aWMgcHJpbnRPYmplY3RzOmJvb2xlYW4gPSBmYWxzZTtcbiAgICBwdWJsaWMgc3RhdGljIGluaXRpYWxpemU6Ym9vbGVhbiA9IEFwcExvZy5zdGFydCgpO1xuICAgIHB1YmxpYyBzdGF0aWMgZ3BzID0gZmFsc2U7XG4gICAgcHVibGljIHN0YXRpYyBzdGFydCgpOmJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyAgc3RhY2tUcmFjZSgpOkFycmF5PGFueT4ge1xuICAgICAgICB2YXIgZXJyOkVycm9yID0gbmV3IEVycm9yKCk7XG4gICAgICAgIHJldHVybiBlcnJbXCJzdGFja1wiXTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBwcmludFRoaXModGhlT2JqZWN0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHRoZU9iamVjdCwgbnVsbCwgNykpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGRlZmF1bHRFeGNlcHRpb25IYW5kbGVyKG1zZzpzdHJpbmcsIHVybDpzdHJpbmcsIGxpbmU6bnVtYmVyLCBjb2w6bnVtYmVyLCBlcnJvcj86RXJyb3IpIDogdm9pZCB7XG5cbiAgICAgICAgdmFyIGV4dHJhID0gIWNvbCA/ICcnIDogJ1xcbmNvbHVtbjogJyArIGNvbDtcbiAgICAgICAgZXh0cmEgKz0gIWVycm9yID8gJycgOiAnXFxuZXJyb3I6ICcgKyBlcnJvcjtcblxuICAgICAgICB2YXIgbWVzc2FnZSA9IFwiRXJyb3I6IFwiICsgbXNnICsgXCI8YnI+IHVybDpcIiArIHVybCArIFwiPGJyPiBubGluZTpcIiArIGxpbmUgKyBcIjxicj5cIiArIGV4dHJhO1xuXG4gICAgICAgIHdlYml4Lm1vZGFsYm94KHtcbiAgICAgICAgICAgIHRpdGxlOiBcIlVuY2F1Z2h0IEV4Y2VwdGlvbiBFZXJyb3JcIixcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcIm9rXCIsIFwiTm90IE9LXCJdLFxuICAgICAgICAgICAgdGV4dDogbWVzc2FnZSxcbiAgICAgICAgICAgIHdpZHRoOiBcIjgwMHB4XCIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIEFwcExvZy5lcnJvcihtc2csIGVycm9yLCB7XG4gICAgICAgICAgICBtc2c6IG1zZyxcbiAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgICAgIGNvbDogY29sLFxuICAgICAgICAgICAgZXJyb3I6IGNvbFxuICAgICAgICB9KVxuXG4gICAgICAgIHZhciBzdXBwcmVzc0Vycm9yQWxlcnQgPSB0cnVlO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIHJlY29yZChtZXNzYWdlLCBlcnJvciwgb2JqZWN0KSB7XG4gICAgICAgIEFwcExvZy5sb2coXCJyZWNvcmRcIiwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCwgdHJ1ZSk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgZXJyb3IobWVzc2FnZSwgZXJyb3I/LCBvYmplY3Q/KSB7XG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIFVJLkVycm9yKG1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIEFwcExvZy5sb2coXCJlcnJvclwiLCBtZXNzYWdlLCBlcnJvciwgb2JqZWN0KTtcbiAgICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgaW5mbyhtZXNzYWdlLCBlcnJvcj8sIG9iamVjdD8pIHtcblxuICAgICAgICBpZiAoQXBwTG9nLmluZm9SZXBvcnQpIEFwcExvZy5sb2coXCJpbmZvXCIsIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEdQU1JldHVybihyZXN1bHQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkdQU1JldHVyblwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihyZXN1bHQpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEdQU1JldHVybkVycm9yKHJlc3VsdCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiR1BTUmV0dXJuIEVycm9yXCIpO1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3JcIik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0KTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBDcmVhdGVHb29kU3RhY2soc3RhY2spIHtcblxuXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTdGFja1RyYWNlXCIpO1xuICAgICAgICBjb25zb2xlLmVycm9yKHN0YWNrKTtcblxuICAgICAgICB2YXIgc3RhY2tGcmFtZSA9IG5ldyBTdGFja0ZyYW1lKHN0YWNrWzBdLmZ1bmN0aW9uTmFtZSwgW10sIHN0YWNrWzBdLmZpbGVOYW1lLCBzdGFja1swXS5saW5lTnVtYmVyLCBzdGFja1swXS5jb2x1bW5OdW1iZXIpXG4gICAgICAgIC8qXG4gICAgICAgICBBcHBMb2cuZ3BzLmdldE1hcHBlZExvY2F0aW9uKHN0YWNrRnJhbWUpLnRoZW4oXG4gICAgICAgICBBcHBMb2cuR1BTUmV0dXJuLFxuICAgICAgICAgQXBwTG9nLkdQU1JldHVybkVycm9yKTtcblxuXG4gICAgICAgICBBcHBMb2cuZ3BzLmdldE1hcHBlZExvY2F0aW9uKHN0YWNrWzBdKS50aGVuKFxuICAgICAgICAgQXBwTG9nLkdQU1JldHVybixcbiAgICAgICAgIEFwcExvZy5HUFNSZXR1cm5FcnJvcik7XG4gICAgICAgICAqL1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGxvZyh0eXBlOnN0cmluZywgbWVzc2FnZTpzdHJpbmcsIGVycm9yPzpFcnJvciwgb2JqZWN0PzphbnksIGRhdGFiYXNlOmJvb2xlYW4gPSBmYWxzZSkge1xuXG4gICAgICAgIC8vIHZhciBjYWxsZXIgPSBhcmd1bWVudHMuY2FsbGVlLmNhbGxlci50b1N0cmluZygpO1xuXG4gICAgICAgIC8vIGlmICghQXBwTG9nLmdwcykge1xuICAgICAgICAvLyAgICBBcHBMb2cuZ3BzID0gbmV3IFN0YWNrVHJhY2VHUFMoKTtcbiAgICAgICAgLy8gfVxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHZhciB0aGVTdGFjayA9IGVycm9yW1wic3RhY2tcIl07XG5cbiAgICAgICAgICAgIC8vIFN0YWNrVHJhY2UuZnJvbUVycm9yKGVycm9yKS50aGVuKFxuXG5cbiAgICAgICAgICAgIC8vIGZ1bmN0aW9uKHN0YWNrKSB7QXBwTG9nLkNyZWF0ZUdvb2RTdGFjayhzdGFjayk7fSk7XG5cblxuICAgICAgICAgICAgLy8gdmFyIHRoZVN0YWNrID0gU3RhY2tUcmFjZS5wcmludFN0YWNrVHJhY2UoKTtcbiAgICAgICAgICAgIC8vdmFyIHRoZVN0YWNrID0gQXBwTG9nLlN0YWNrVG9TdHJpbmcodGhlU3RhY2spO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhlU3RhY2sgPSBcIlwiO1xuXG4gICAgICAgIGlmICh0eXBlID09IFwiaW5mb1wiICYmICFBcHBMb2cuaW5mbylcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB2YXIgZGVzY3JpcHRpb24gPSB0eXBlICsgXCIgXCIgKyBtZXNzYWdlICsgXCIgXCIgKyBlcnJvcjtcblxuICAgICAgICAvKlxuICAgICAgICAgaWYgKHdpbmRvdykge1xuICAgICAgICAgdmFyIHRoZU5hdmlnYXRvciA9IG5hdmlnYXRvclxuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB0aGVOYXZpZ2F0b3IgPSBudWxsO1xuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHRoZU5hdmlnYXRvciA9IG51bGw7XG5cbiAgICAgICAgaWYgKCFBcHBMb2cubm9EQilcbiAgICAgICAgICAgIEFwcExvZy5BZGQodHlwZSwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCwgdGhlU3RhY2ssIHRoZU5hdmlnYXRvcik7XG4gICAgICAgIGVsc2UgaWYgKChBcHBMb2cuZXJyb3JPbmx5REIgJiYgdHlwZSA9PSBcImVycm9yXCIpIHx8IGRhdGFiYXNlKVxuICAgICAgICAgICAgQXBwTG9nLkFkZCh0eXBlLCBtZXNzYWdlLCBlcnJvciwgb2JqZWN0LCB0aGVTdGFjaywgdGhlTmF2aWdhdG9yKTtcblxuICAgICAgICAvL2NvbnNvbGUuZXJyb3IoXCJOYXZpZ2F0b3IgOiBcIisgQXBwTG9nLnByZXR0eVByaW50KHRoZU5hdmlnYXRvcikpO1xuICAgICAgICAvL2NvbnNvbGUuZXJyb3IoXCJDYWxsZXIgOiBcIiArIGNhbGxlcilcbiAgICAgICAgY29uc29sZS5lcnJvcihkZXNjcmlwdGlvbik7XG4gICAgICAgIGlmICh0eXBlID09IFwiZXJyb3JcIikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKEFwcExvZy5wcmV0dHlQcmludCh0aGVTdGFjaykpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvYmplY3QpXG4gICAgICAgICAgICBpZiAoQXBwTG9nLnByaW50T2JqZWN0cylcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKEFwcExvZy5wcmV0dHlQcmludChvYmplY3QpKTtcblxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFN0YWNrVG9TdHJpbmcodGhlU3RhY2s6QXJyYXk8YW55Pik6c3RyaW5nIHtcblxuICAgICAgICB2YXIgdGhlU3RyaW5nID0gXCJcIjtcblxuICAgICAgICBmb3IgKHZhciBpdGVtIGluIHRoZVN0YWNrKSB7XG4gICAgICAgICAgICB0aGVTdHJpbmcgKz0gdGhlU3RhY2tbaXRlbV0gKyBcIlxcblwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGVTdHJpbmc7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgUHJpbnRPYmplY3Qob2JqZWN0OmFueSk6c3RyaW5nIHtcblxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqZWN0LCBudWxsLCA0KTtcblxuXG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgY2FzdCh0aGVPYmplY3Q6YW55KTpFSlNPTiB7XG5cbiAgICAgICAgcmV0dXJuIDxFSlNPTj4gdGhlT2JqZWN0O1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIE1ha2VKU09OKG9iamVjdDphbnkpOmFueSB7XG5cbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KEpTT04uZGVjeWNsZShvYmplY3QpLCBudWxsLCA0KTtcblxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEFkZCh0eXBlLCBtZXNzYWdlLCBlcnJvcj8sIG9iamVjdD8sIGNhbGxlcj8sIGJyb3dzZXI/KSB7XG5cbiAgICAgICAgdmFyIHRoZURlc2NyaXB0aW9uID0gdHlwZSArIFwiIFwiICsgbWVzc2FnZSArIFwiIFwiICsgZXJyb3I7XG5cbiAgICAgICAgdmFyIG9iamVjdEFycmF5ID0gbmV3IEFycmF5PE9iamVjdD4oKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBlcnJvcjtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JKc29uID0gQXBwTG9nLk1ha2VKU09OKG9iamVjdEFycmF5KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBcIk5vIEVycm9yXCI7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9ySnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vaWdub3JlIGFuZCBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKG9iamVjdCkge1xuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gb2JqZWN0O1xuICAgICAgICAgICAgICAgIHZhciBvYmplY3RKc29uID0gQXBwTG9nLk1ha2VKU09OKG9iamVjdEFycmF5KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBcIk5vIE9iamVjdFwiO1xuICAgICAgICAgICAgICAgIHZhciBvYmplY3RKc29uID0gQXBwTG9nLk1ha2VKU09OKG9iamVjdEFycmF5KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGJyb3dzZXIpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IGJyb3dzZXI7XG4gICAgICAgICAgICAgICAgdmFyIGJyb3dzZXJKc29uID0gQXBwTG9nLk1ha2VKU09OKChvYmplY3RBcnJheSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IFwiTm8gT2JqZWN0XCI7XG4gICAgICAgICAgICAgICAgYnJvd3Nlckpzb24gPSBBcHBMb2cuTWFrZUpTT04oKG9iamVjdEFycmF5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBDNGxvZ0RCLmluc2VydCh7XG4gICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGVEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBlcnJvck9iamVjdDogZXJyb3JKc29uLFxuICAgICAgICAgICAgICAgIG9iamVjdDogb2JqZWN0SnNvbixcbiAgICAgICAgICAgICAgICBjYWxsZXI6IGNhbGxlcixcbiAgICAgICAgICAgICAgICBicm93c2VyOiBicm93c2VySnNvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgTG9nZ2luZyBDNCBFcnJvciBpbiBEQlwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgcHJldHR5UHJpbnQob2JqOmFueSwgaW5kZW50ID0gMCkge1xuXG4gICAgICAgIGlmICghb2JqKVxuICAgICAgICAgICAgcmV0dXJuIFwibnVsbFwiO1xuXG4gICAgICAgIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgICAgICAgICBuZXdMaW5lID0gXCI8YnI+XCIsIHNwYWNlID0gXCImbmJzcDtcIiwgdGFiID0gOCxcbiAgICAgICAgICAgIGJ1ZmZlciA9IFwiXCIsXG4gICAgICAgIC8vU2Vjb25kIGFyZ3VtZW50IGlzIGluZGVudFxuICAgICAgICAvL0ZvciBiZXR0ZXIgcGVyZm9ybWFuY2UsIENhY2hlIGluZGVudFN0ciBmb3IgYSBnaXZlbiBpbmRlbnQuXG4gICAgICAgICAgICBpbmRlbnRTdHIgPSAoZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICB3aGlsZSAobi0tKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ciArPSBzcGFjZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICAgICAgIH0pKGluZGVudCk7XG5cbiAgICAgICAgaWYgKCFvYmogfHwgKCB0eXBlb2Ygb2JqICE9IFwib2JqZWN0XCIgJiYgdHlwZW9mIG9iaiAhPSBcImZ1bmN0aW9uXCIgKSkge1xuICAgICAgICAgICAgLy9hbnkgbm9uLW9iamVjdCAoIEJvb2xlYW4sIFN0cmluZywgTnVtYmVyKSwgbnVsbCwgdW5kZWZpbmVkLCBOYU5cbiAgICAgICAgICAgIGJ1ZmZlciArPSBvYmo7XG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBEYXRlXVwiKSB7XG4gICAgICAgICAgICBidWZmZXIgKz0gXCJbRGF0ZV0gXCIgKyBvYmo7XG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBSZWdFeHBcIikge1xuICAgICAgICAgICAgYnVmZmVyICs9IFwiW1JlZ0V4cF0gXCIgKyBvYmo7XG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBGdW5jdGlvbl1cIikge1xuICAgICAgICAgICAgYnVmZmVyICs9IFwiW0Z1bmN0aW9uXSBcIiArIG9iajtcbiAgICAgICAgfSBlbHNlIGlmICh0b1N0cmluZy5jYWxsKG9iaikgPT0gXCJbb2JqZWN0IEFycmF5XVwiKSB7XG4gICAgICAgICAgICB2YXIgaWR4ID0gMCwgbGVuID0gb2JqLmxlbmd0aDtcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIltcIiArIG5ld0xpbmU7XG4gICAgICAgICAgICB3aGlsZSAoaWR4IDwgbGVuKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IFtcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50U3RyLCBpZHgsIFwiOiBcIixcbiAgICAgICAgICAgICAgICAgICAgQXBwTG9nLnByZXR0eVByaW50KG9ialtpZHhdLCBpbmRlbnQgKyB0YWIpXG4gICAgICAgICAgICAgICAgXS5qb2luKFwiXCIpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBcIjxicj5cIjtcbiAgICAgICAgICAgICAgICBpZHgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJ1ZmZlciArPSBpbmRlbnRTdHIgKyBcIl1cIjtcbiAgICAgICAgfSBlbHNlIHsgLy9IYW5kbGUgT2JqZWN0XG4gICAgICAgICAgICB2YXIgcHJvcDtcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIntcIiArIG5ld0xpbmU7XG4gICAgICAgICAgICBmb3IgKHByb3AgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IFtcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50U3RyLCBwcm9wLCBcIjogXCIsXG4gICAgICAgICAgICAgICAgICAgIEFwcExvZy5wcmV0dHlQcmludChvYmpbcHJvcF0sIGluZGVudCArIHRhYilcbiAgICAgICAgICAgICAgICBdLmpvaW4oXCJcIik7XG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IG5ld0xpbmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidWZmZXIgKz0gaW5kZW50U3RyICsgXCJ9XCI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYnVmZmVyO1xuICAgIH1cbn0gdGhpcy5BcHBMb2cgPSBBcHBMb2c7XG5cbnRoaXMuam9iTG9nZ2VyID0gZnVuY3Rpb24gKG9wdHMpIHtcbiAgICBBcHBMb2cuaW5mbyhcIkpvYiBMb2dnZXIgTWVzc2FnZSA6IFwiICsgb3B0cy5tZXNzYWdlICsgXCIgTGV2ZWwgOiBcIiArIG9wdHMubGV2ZWwsIG5ldyBFcnJvcigpLCB7XG4gICAgICAgIGxldmVsOiBvcHRzLmxldmVsLFxuICAgICAgICBtZXNzYWdlOiBvcHRzLm1lc3NhZ2UsXG4gICAgICAgIHRhZ3M6IG9wdHMudGFnXG4gICAgfSk7XG59XG5cbmNsYXNzIFZpZGVvQXBwIHtcbiAgICBwdWJsaWMgc3RhdGljIGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UsIGVycm9yPzpFcnJvciwgb2JqZWN0PzphbnkpIHtcbiAgICAgICAgaWYgKCFjb25kaXRpb24pIHtcbiAgICAgICAgICAgIEFwcExvZy5lcnJvcihcIkFzc2VydGlvbiBcIiArIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QpO1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZSB8fCBcIkFzc2VydGlvbiBmYWlsZWRcIjtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgRXJyb3IgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBtZXNzYWdlOyAvLyBGYWxsYmFja1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgRUpTT05jYXN0KHRoZU9iamVjdCk6RUpTT04ge1xuXG4gICAgICAgIHJldHVybiA8RUpTT04+IHRoZU9iamVjdDtcbiAgICB9XG59dGhpcy5WaWRlb0FwcCA9IFZpZGVvQXBwO1xuXG5cbiJdfQ==