/// <reference path="../typescript-defs/all-definitions.d.ts"/>
/// <reference path="../typescript-defs/stack-trace.d.ts"/>
console.log("Loading AppLog.ts ...");
class AppLog {
    static start() {
        return true;
    }
    static stackTrace() {
        var err = new Error();
        return err["stack"];
    }
    static printThis(theObject) {
        //console.log(JSON.stringify(theObject, null, 7));
    }
    static defaultExceptionHandler(msg, url, line, col, error) {
        var extra = !col ? '' : '\ncolumn: ' + col;
        extra += !error ? '' : '\nerror: ' + error;
        var message = "Error: " + msg + "<br> url:" + url + "<br> nline:" + line + "<br>" + extra;
        webix.modalbox({
            title: "Uncaught Exception Eerror",
            buttons: ["ok", "Not OK"],
            text: message,
            width: "800px",
        });
        AppLog.error(msg, error, {
            msg: msg,
            url: url,
            line: line,
            col: col,
            error: col
        });
        var suppressErrorAlert = true;
    }
    static record(message, error, object) {
        AppLog.log("record", message, error, object, true);
    }
    static error(message, error, object) {
        if (typeof window != "undefined") {
            UI.Error(message);
        }
        AppLog.log("error", message, error, object);
        debugger;
    }
    static info(message, error, object) {
        if (AppLog.infoReport)
            AppLog.log("info", message, error, object);
    }
    static GPSReturn(result) {
        console.error("GPSReturn");
        console.error(result);
    }
    static GPSReturnError(result) {
        console.error("GPSReturn Error");
        console.error("Error");
        console.error(result);
    }
    static CreateGoodStack(stack) {
        console.error("StackTrace");
        console.error(stack);
        var stackFrame = new StackFrame(stack[0].functionName, [], stack[0].fileName, stack[0].lineNumber, stack[0].columnNumber);
        /*
         AppLog.gps.getMappedLocation(stackFrame).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);


         AppLog.gps.getMappedLocation(stack[0]).then(
         AppLog.GPSReturn,
         AppLog.GPSReturnError);
         */
    }
    static log(type, message, error, object, database = false) {
        // var caller = arguments.callee.caller.toString();
        // if (!AppLog.gps) {
        //    AppLog.gps = new StackTraceGPS();
        // }
        if (error) {
            var theStack = error["stack"];
        }
        else
            theStack = "";
        if (type == "info" && !AppLog.info)
            return;
        var description = type + " " + message + " " + error;
        /*
         if (window) {
         var theNavigator = navigator
         }
         else theNavigator = null;
         */
        var theNavigator = null;
        if (!AppLog.noDB)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        else if ((AppLog.errorOnlyDB && type == "error") || database)
            AppLog.Add(type, message, error, object, theStack, theNavigator);
        //console.error("Navigator : "+ AppLog.prettyPrint(theNavigator));
        //console.error("Caller : " + caller)
        console.error(description);
        if (type == "error") {
            console.error(error);
            console.error(AppLog.prettyPrint(theStack));
        }
        if (object)
            if (AppLog.printObjects)
                console.error(AppLog.prettyPrint(object));
    }
    static StackToString(theStack) {
        var theString = "";
        for (var item in theStack) {
            theString += theStack[item] + "\n";
        }
        return theString;
    }
    static PrintObject(object) {
        return JSON.stringify(object, null, 4);
    }
    static cast(theObject) {
        return theObject;
    }
    static MakeJSON(object) {
        return JSON.stringify(JSON.decycle(object), null, 4);
    }
    static Add(type, message, error, object, caller, browser) {
        var theDescription = type + " " + message + " " + error;
        var objectArray = new Array();
        try {
            if (error) {
                objectArray[0] = error;
                var errorJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Error";
                var errorJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (object) {
                objectArray[0] = object;
                var objectJson = AppLog.MakeJSON(objectArray);
            }
            else {
                objectArray[0] = "No Object";
                var objectJson = AppLog.MakeJSON(objectArray);
            }
        }
        catch (e) {
        }
        try {
            if (browser) {
                objectArray[0] = browser;
                var browserJson = AppLog.MakeJSON((objectArray));
            }
            else {
                objectArray[0] = "No Object";
                browserJson = AppLog.MakeJSON((objectArray));
            }
        }
        catch (e) {
        }
        try {
            C4logDB.insert({
                type: type,
                message: message,
                description: theDescription,
                errorObject: errorJson,
                object: objectJson,
                caller: caller,
                browser: browserJson
            });
        }
        catch (e) {
            console.log("Error Logging C4 Error in DB");
            return;
        }
    }
    static prettyPrint(obj, indent = 0) {
        if (!obj)
            return "null";
        var toString = Object.prototype.toString, newLine = "<br>", space = "&nbsp;", tab = 8, buffer = "", 
        //Second argument is indent
        //For better performance, Cache indentStr for a given indent.
        indentStr = (function (n) {
            var str = "";
            while (n--) {
                str += space;
            }
            return str;
        })(indent);
        if (!obj || (typeof obj != "object" && typeof obj != "function")) {
            //any non-object ( Boolean, String, Number), null, undefined, NaN
            buffer += obj;
        }
        else if (toString.call(obj) == "[object Date]") {
            buffer += "[Date] " + obj;
        }
        else if (toString.call(obj) == "[object RegExp") {
            buffer += "[RegExp] " + obj;
        }
        else if (toString.call(obj) == "[object Function]") {
            buffer += "[Function] " + obj;
        }
        else if (toString.call(obj) == "[object Array]") {
            var idx = 0, len = obj.length;
            buffer += "[" + newLine;
            while (idx < len) {
                buffer += [
                    indentStr, idx, ": ",
                    AppLog.prettyPrint(obj[idx], indent + tab)
                ].join("");
                buffer += "<br>";
                idx++;
            }
            buffer += indentStr + "]";
        }
        else {
            var prop;
            buffer += "{" + newLine;
            for (prop in obj) {
                buffer += [
                    indentStr, prop, ": ",
                    AppLog.prettyPrint(obj[prop], indent + tab)
                ].join("");
                buffer += newLine;
            }
            buffer += indentStr + "}";
        }
        return buffer;
    }
}
AppLog.infoReport = true;
AppLog.noDB = true;
AppLog.errorOnlyDB = true;
AppLog.printObjects = false;
AppLog.initialize = AppLog.start();
AppLog.gps = false;
this.AppLog = AppLog;
this.jobLogger = function (opts) {
    AppLog.info("Job Logger Message : " + opts.message + " Level : " + opts.level, new Error(), {
        level: opts.level,
        message: opts.message,
        tags: opts.tag
    });
};
class VideoApp {
    static assert(condition, message, error, object) {
        if (!condition) {
            AppLog.error("Assertion " + message, error, object);
            debugger;
            message = message || "Assertion failed";
            if (typeof Error !== "undefined") {
                throw new Error(message);
            }
            throw message; // Fallback
        }
    }
    static EJSONcast(theObject) {
        return theObject;
    }
}
this.VideoApp = VideoApp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzRsb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJDNGxvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrREFBK0Q7QUFDL0QsMkRBQTJEO0FBTzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUVyQztJQVFJLE9BQWMsS0FBSztRQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNELE9BQWUsVUFBVTtRQUNyQixJQUFJLEdBQUcsR0FBUyxJQUFJLEtBQUssRUFBRSxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNELE9BQWMsU0FBUyxDQUFDLFNBQVM7UUFDN0Isa0RBQWtEO0lBQ3RELENBQUM7SUFDRCxPQUFjLHVCQUF1QixDQUFDLEdBQVUsRUFBRSxHQUFVLEVBQUUsSUFBVyxFQUFFLEdBQVUsRUFBRSxLQUFZO1FBRS9GLElBQUksS0FBSyxHQUFHLENBQUMsR0FBRyxHQUFHLEVBQUUsR0FBRyxZQUFZLEdBQUcsR0FBRyxDQUFDO1FBQzNDLEtBQUssSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLEdBQUcsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUUzQyxJQUFJLE9BQU8sR0FBRyxTQUFTLEdBQUcsR0FBRyxHQUFHLFdBQVcsR0FBRyxHQUFHLEdBQUcsYUFBYSxHQUFHLElBQUksR0FBRyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRTFGLEtBQUssQ0FBQyxRQUFRLENBQUM7WUFDWCxLQUFLLEVBQUUsMkJBQTJCO1lBQ2xDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUM7WUFDekIsSUFBSSxFQUFFLE9BQU87WUFDYixLQUFLLEVBQUUsT0FBTztTQUNqQixDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUU7WUFDckIsR0FBRyxFQUFFLEdBQUc7WUFDUixHQUFHLEVBQUUsR0FB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QUM7Z0JBQy9CLE1BQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0IsQ0FBQztZQUNELE1BQU0sT0FBTyxDQUFDLENBQUMsV0FBVztRQUM5QixDQUFDO0lBQ0wsQ0FBQztJQUNELE9BQWMsU0FBUyxDQUFDLFNBQVM7UUFFN0IsTUFBTSxDQUFTLFNBQVMsQ0FBQztJQUM3QixDQUFDO0FBQ0wsQ0FBQztBQUFBLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGVzY3JpcHQtZGVmcy9hbGwtZGVmaW5pdGlvbnMuZC50c1wiLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBlc2NyaXB0LWRlZnMvc3RhY2stdHJhY2UuZC50c1wiLz5cblxuZGVjbGFyZSB2YXIgQzRsb2dEQjpNb25nby5Db2xsZWN0aW9uPGFueT5cbmRlY2xhcmUgdmFyIFN0YWNrRnJhbWU6YW55O1xuZGVjbGFyZSB2YXIgU3RhY2tUcmFjZUdQUzphbnk7XG5kZWNsYXJlIHZhciBTdGFja1RyYWNlOmFueTtcblxuY29uc29sZS5sb2coXCJMb2FkaW5nIEFwcExvZy50cyAuLi5cIik7XG5cbmNsYXNzIEFwcExvZyB7XG5cbiAgICBwdWJsaWMgc3RhdGljIGluZm9SZXBvcnQ6Ym9vbGVhbiA9IHRydWU7XG4gICAgcHVibGljIHN0YXRpYyBub0RCOmJvb2xlYW4gPSB0cnVlO1xuICAgIHB1YmxpYyBzdGF0aWMgZXJyb3JPbmx5REI6Ym9vbGVhbiA9IHRydWU7XG4gICAgcHVibGljIHN0YXRpYyBwcmludE9iamVjdHM6Ym9vbGVhbiA9IGZhbHNlO1xuICAgIHB1YmxpYyBzdGF0aWMgaW5pdGlhbGl6ZTpib29sZWFuID0gQXBwTG9nLnN0YXJ0KCk7XG4gICAgcHVibGljIHN0YXRpYyBncHMgPSBmYWxzZTtcbiAgICBwdWJsaWMgc3RhdGljIHN0YXJ0KCk6Ym9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljICBzdGFja1RyYWNlKCk6QXJyYXk8YW55PiB7XG4gICAgICAgIHZhciBlcnI6RXJyb3IgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgcmV0dXJuIGVycltcInN0YWNrXCJdO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIHByaW50VGhpcyh0aGVPYmplY3QpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGVPYmplY3QsIG51bGwsIDcpKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBkZWZhdWx0RXhjZXB0aW9uSGFuZGxlcihtc2c6c3RyaW5nLCB1cmw6c3RyaW5nLCBsaW5lOm51bWJlciwgY29sOm51bWJlciwgZXJyb3I/OkVycm9yKSA6IHZvaWQge1xuXG4gICAgICAgIHZhciBleHRyYSA9ICFjb2wgPyAnJyA6ICdcXG5jb2x1bW46ICcgKyBjb2w7XG4gICAgICAgIGV4dHJhICs9ICFlcnJvciA/ICcnIDogJ1xcbmVycm9yOiAnICsgZXJyb3I7XG5cbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIkVycm9yOiBcIiArIG1zZyArIFwiPGJyPiB1cmw6XCIgKyB1cmwgKyBcIjxicj4gbmxpbmU6XCIgKyBsaW5lICsgXCI8YnI+XCIgKyBleHRyYTtcblxuICAgICAgICB3ZWJpeC5tb2RhbGJveCh7XG4gICAgICAgICAgICB0aXRsZTogXCJVbmNhdWdodCBFeGNlcHRpb24gRWVycm9yXCIsXG4gICAgICAgICAgICBidXR0b25zOiBbXCJva1wiLCBcIk5vdCBPS1wiXSxcbiAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXG4gICAgICAgICAgICB3aWR0aDogXCI4MDBweFwiLFxuICAgICAgICB9KTtcblxuICAgICAgICBBcHBMb2cuZXJyb3IobXNnLCBlcnJvciwge1xuICAgICAgICAgICAgbXNnOiBtc2csXG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIGxpbmU6IGxpbmUsXG4gICAgICAgICAgICBjb2w6IGNvbCxcbiAgICAgICAgICAgIGVycm9yOiBjb2xcbiAgICAgICAgfSlcblxuICAgICAgICB2YXIgc3VwcHJlc3NFcnJvckFsZXJ0ID0gdHJ1ZTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyByZWNvcmQobWVzc2FnZSwgZXJyb3IsIG9iamVjdCkge1xuICAgICAgICBBcHBMb2cubG9nKFwicmVjb3JkXCIsIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QsIHRydWUpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGVycm9yKG1lc3NhZ2UsIGVycm9yPywgb2JqZWN0Pykge1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBVSS5FcnJvcihtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBBcHBMb2cubG9nKFwiZXJyb3JcIiwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCk7XG4gICAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGluZm8obWVzc2FnZSwgZXJyb3I/LCBvYmplY3Q/KSB7XG5cbiAgICAgICAgaWYgKEFwcExvZy5pbmZvUmVwb3J0KSBBcHBMb2cubG9nKFwiaW5mb1wiLCBtZXNzYWdlLCBlcnJvciwgb2JqZWN0KTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBHUFNSZXR1cm4ocmVzdWx0KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJHUFNSZXR1cm5cIik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0KTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBHUFNSZXR1cm5FcnJvcihyZXN1bHQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkdQU1JldHVybiBFcnJvclwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yXCIpO1xuICAgICAgICBjb25zb2xlLmVycm9yKHJlc3VsdCk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgQ3JlYXRlR29vZFN0YWNrKHN0YWNrKSB7XG5cblxuICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RhY2tUcmFjZVwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihzdGFjayk7XG5cbiAgICAgICAgdmFyIHN0YWNrRnJhbWUgPSBuZXcgU3RhY2tGcmFtZShzdGFja1swXS5mdW5jdGlvbk5hbWUsIFtdLCBzdGFja1swXS5maWxlTmFtZSwgc3RhY2tbMF0ubGluZU51bWJlciwgc3RhY2tbMF0uY29sdW1uTnVtYmVyKVxuICAgICAgICAvKlxuICAgICAgICAgQXBwTG9nLmdwcy5nZXRNYXBwZWRMb2NhdGlvbihzdGFja0ZyYW1lKS50aGVuKFxuICAgICAgICAgQXBwTG9nLkdQU1JldHVybixcbiAgICAgICAgIEFwcExvZy5HUFNSZXR1cm5FcnJvcik7XG5cblxuICAgICAgICAgQXBwTG9nLmdwcy5nZXRNYXBwZWRMb2NhdGlvbihzdGFja1swXSkudGhlbihcbiAgICAgICAgIEFwcExvZy5HUFNSZXR1cm4sXG4gICAgICAgICBBcHBMb2cuR1BTUmV0dXJuRXJyb3IpO1xuICAgICAgICAgKi9cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBsb2codHlwZTpzdHJpbmcsIG1lc3NhZ2U6c3RyaW5nLCBlcnJvcj86RXJyb3IsIG9iamVjdD86YW55LCBkYXRhYmFzZTpib29sZWFuID0gZmFsc2UpIHtcblxuICAgICAgICAvLyB2YXIgY2FsbGVyID0gYXJndW1lbnRzLmNhbGxlZS5jYWxsZXIudG9TdHJpbmcoKTtcblxuICAgICAgICAvLyBpZiAoIUFwcExvZy5ncHMpIHtcbiAgICAgICAgLy8gICAgQXBwTG9nLmdwcyA9IG5ldyBTdGFja1RyYWNlR1BTKCk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICB2YXIgdGhlU3RhY2sgPSBlcnJvcltcInN0YWNrXCJdO1xuXG4gICAgICAgICAgICAvLyBTdGFja1RyYWNlLmZyb21FcnJvcihlcnJvcikudGhlbihcblxuXG4gICAgICAgICAgICAvLyBmdW5jdGlvbihzdGFjaykge0FwcExvZy5DcmVhdGVHb29kU3RhY2soc3RhY2spO30pO1xuXG5cbiAgICAgICAgICAgIC8vIHZhciB0aGVTdGFjayA9IFN0YWNrVHJhY2UucHJpbnRTdGFja1RyYWNlKCk7XG4gICAgICAgICAgICAvL3ZhciB0aGVTdGFjayA9IEFwcExvZy5TdGFja1RvU3RyaW5nKHRoZVN0YWNrKTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoZVN0YWNrID0gXCJcIjtcblxuICAgICAgICBpZiAodHlwZSA9PSBcImluZm9cIiAmJiAhQXBwTG9nLmluZm8pXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0gdHlwZSArIFwiIFwiICsgbWVzc2FnZSArIFwiIFwiICsgZXJyb3I7XG5cbiAgICAgICAgLypcbiAgICAgICAgIGlmICh3aW5kb3cpIHtcbiAgICAgICAgIHZhciB0aGVOYXZpZ2F0b3IgPSBuYXZpZ2F0b3JcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgdGhlTmF2aWdhdG9yID0gbnVsbDtcbiAgICAgICAgICovXG4gICAgICAgIHZhciB0aGVOYXZpZ2F0b3IgPSBudWxsO1xuXG4gICAgICAgIGlmICghQXBwTG9nLm5vREIpXG4gICAgICAgICAgICBBcHBMb2cuQWRkKHR5cGUsIG1lc3NhZ2UsIGVycm9yLCBvYmplY3QsIHRoZVN0YWNrLCB0aGVOYXZpZ2F0b3IpO1xuICAgICAgICBlbHNlIGlmICgoQXBwTG9nLmVycm9yT25seURCICYmIHR5cGUgPT0gXCJlcnJvclwiKSB8fCBkYXRhYmFzZSlcbiAgICAgICAgICAgIEFwcExvZy5BZGQodHlwZSwgbWVzc2FnZSwgZXJyb3IsIG9iamVjdCwgdGhlU3RhY2ssIHRoZU5hdmlnYXRvcik7XG5cbiAgICAgICAgLy9jb25zb2xlLmVycm9yKFwiTmF2aWdhdG9yIDogXCIrIEFwcExvZy5wcmV0dHlQcmludCh0aGVOYXZpZ2F0b3IpKTtcbiAgICAgICAgLy9jb25zb2xlLmVycm9yKFwiQ2FsbGVyIDogXCIgKyBjYWxsZXIpXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZGVzY3JpcHRpb24pO1xuICAgICAgICBpZiAodHlwZSA9PSBcImVycm9yXCIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihBcHBMb2cucHJldHR5UHJpbnQodGhlU3RhY2spKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqZWN0KVxuICAgICAgICAgICAgaWYgKEFwcExvZy5wcmludE9iamVjdHMpXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihBcHBMb2cucHJldHR5UHJpbnQob2JqZWN0KSk7XG5cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBTdGFja1RvU3RyaW5nKHRoZVN0YWNrOkFycmF5PGFueT4pOnN0cmluZyB7XG5cbiAgICAgICAgdmFyIHRoZVN0cmluZyA9IFwiXCI7XG5cbiAgICAgICAgZm9yICh2YXIgaXRlbSBpbiB0aGVTdGFjaykge1xuICAgICAgICAgICAgdGhlU3RyaW5nICs9IHRoZVN0YWNrW2l0ZW1dICsgXCJcXG5cIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhlU3RyaW5nO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFByaW50T2JqZWN0KG9iamVjdDphbnkpOnN0cmluZyB7XG5cbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iamVjdCwgbnVsbCwgNCk7XG5cblxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGNhc3QodGhlT2JqZWN0OmFueSk6RUpTT04ge1xuXG4gICAgICAgIHJldHVybiA8RUpTT04+IHRoZU9iamVjdDtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBNYWtlSlNPTihvYmplY3Q6YW55KTphbnkge1xuXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShKU09OLmRlY3ljbGUob2JqZWN0KSwgbnVsbCwgNCk7XG5cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBBZGQodHlwZSwgbWVzc2FnZSwgZXJyb3I/LCBvYmplY3Q/LCBjYWxsZXI/LCBicm93c2VyPykge1xuXG4gICAgICAgIHZhciB0aGVEZXNjcmlwdGlvbiA9IHR5cGUgKyBcIiBcIiArIG1lc3NhZ2UgKyBcIiBcIiArIGVycm9yO1xuXG4gICAgICAgIHZhciBvYmplY3RBcnJheSA9IG5ldyBBcnJheTxPYmplY3Q+KCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gZXJyb3I7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9ySnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gXCJObyBFcnJvclwiO1xuICAgICAgICAgICAgICAgIHZhciBlcnJvckpzb24gPSBBcHBMb2cuTWFrZUpTT04ob2JqZWN0QXJyYXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvL2lnbm9yZSBhbmQgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChvYmplY3QpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RBcnJheVswXSA9IG9iamVjdDtcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0SnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iamVjdEFycmF5WzBdID0gXCJObyBPYmplY3RcIjtcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0SnNvbiA9IEFwcExvZy5NYWtlSlNPTihvYmplY3RBcnJheSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChicm93c2VyKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBicm93c2VyO1xuICAgICAgICAgICAgICAgIHZhciBicm93c2VySnNvbiA9IEFwcExvZy5NYWtlSlNPTigob2JqZWN0QXJyYXkpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0QXJyYXlbMF0gPSBcIk5vIE9iamVjdFwiO1xuICAgICAgICAgICAgICAgIGJyb3dzZXJKc29uID0gQXBwTG9nLk1ha2VKU09OKChvYmplY3RBcnJheSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgQzRsb2dEQi5pbnNlcnQoe1xuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgZXJyb3JPYmplY3Q6IGVycm9ySnNvbixcbiAgICAgICAgICAgICAgICBvYmplY3Q6IG9iamVjdEpzb24sXG4gICAgICAgICAgICAgICAgY2FsbGVyOiBjYWxsZXIsXG4gICAgICAgICAgICAgICAgYnJvd3NlcjogYnJvd3Nlckpzb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIExvZ2dpbmcgQzQgRXJyb3IgaW4gREJcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIHByZXR0eVByaW50KG9iajphbnksIGluZGVudCA9IDApIHtcblxuICAgICAgICBpZiAoIW9iailcbiAgICAgICAgICAgIHJldHVybiBcIm51bGxcIjtcblxuICAgICAgICB2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgICAgICAgICAgbmV3TGluZSA9IFwiPGJyPlwiLCBzcGFjZSA9IFwiJm5ic3A7XCIsIHRhYiA9IDgsXG4gICAgICAgICAgICBidWZmZXIgPSBcIlwiLFxuICAgICAgICAvL1NlY29uZCBhcmd1bWVudCBpcyBpbmRlbnRcbiAgICAgICAgLy9Gb3IgYmV0dGVyIHBlcmZvcm1hbmNlLCBDYWNoZSBpbmRlbnRTdHIgZm9yIGEgZ2l2ZW4gaW5kZW50LlxuICAgICAgICAgICAgaW5kZW50U3RyID0gKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgd2hpbGUgKG4tLSkge1xuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gc3BhY2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzdHI7XG4gICAgICAgICAgICB9KShpbmRlbnQpO1xuXG4gICAgICAgIGlmICghb2JqIHx8ICggdHlwZW9mIG9iaiAhPSBcIm9iamVjdFwiICYmIHR5cGVvZiBvYmogIT0gXCJmdW5jdGlvblwiICkpIHtcbiAgICAgICAgICAgIC8vYW55IG5vbi1vYmplY3QgKCBCb29sZWFuLCBTdHJpbmcsIE51bWJlciksIG51bGwsIHVuZGVmaW5lZCwgTmFOXG4gICAgICAgICAgICBidWZmZXIgKz0gb2JqO1xuICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgRGF0ZV1cIikge1xuICAgICAgICAgICAgYnVmZmVyICs9IFwiW0RhdGVdIFwiICsgb2JqO1xuICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgUmVnRXhwXCIpIHtcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIltSZWdFeHBdIFwiICsgb2JqO1xuICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgRnVuY3Rpb25dXCIpIHtcbiAgICAgICAgICAgIGJ1ZmZlciArPSBcIltGdW5jdGlvbl0gXCIgKyBvYmo7XG4gICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvYmopID09IFwiW29iamVjdCBBcnJheV1cIikge1xuICAgICAgICAgICAgdmFyIGlkeCA9IDAsIGxlbiA9IG9iai5sZW5ndGg7XG4gICAgICAgICAgICBidWZmZXIgKz0gXCJbXCIgKyBuZXdMaW5lO1xuICAgICAgICAgICAgd2hpbGUgKGlkeCA8IGxlbikge1xuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBbXG4gICAgICAgICAgICAgICAgICAgIGluZGVudFN0ciwgaWR4LCBcIjogXCIsXG4gICAgICAgICAgICAgICAgICAgIEFwcExvZy5wcmV0dHlQcmludChvYmpbaWR4XSwgaW5kZW50ICsgdGFiKVxuICAgICAgICAgICAgICAgIF0uam9pbihcIlwiKTtcbiAgICAgICAgICAgICAgICBidWZmZXIgKz0gXCI8YnI+XCI7XG4gICAgICAgICAgICAgICAgaWR4Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidWZmZXIgKz0gaW5kZW50U3RyICsgXCJdXCI7XG4gICAgICAgIH0gZWxzZSB7IC8vSGFuZGxlIE9iamVjdFxuICAgICAgICAgICAgdmFyIHByb3A7XG4gICAgICAgICAgICBidWZmZXIgKz0gXCJ7XCIgKyBuZXdMaW5lO1xuICAgICAgICAgICAgZm9yIChwcm9wIGluIG9iaikge1xuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBbXG4gICAgICAgICAgICAgICAgICAgIGluZGVudFN0ciwgcHJvcCwgXCI6IFwiLFxuICAgICAgICAgICAgICAgICAgICBBcHBMb2cucHJldHR5UHJpbnQob2JqW3Byb3BdLCBpbmRlbnQgKyB0YWIpXG4gICAgICAgICAgICAgICAgXS5qb2luKFwiXCIpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBuZXdMaW5lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnVmZmVyICs9IGluZGVudFN0ciArIFwifVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGJ1ZmZlcjtcbiAgICB9XG59IHRoaXMuQXBwTG9nID0gQXBwTG9nO1xuXG50aGlzLmpvYkxvZ2dlciA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gICAgQXBwTG9nLmluZm8oXCJKb2IgTG9nZ2VyIE1lc3NhZ2UgOiBcIiArIG9wdHMubWVzc2FnZSArIFwiIExldmVsIDogXCIgKyBvcHRzLmxldmVsLCBuZXcgRXJyb3IoKSwge1xuICAgICAgICBsZXZlbDogb3B0cy5sZXZlbCxcbiAgICAgICAgbWVzc2FnZTogb3B0cy5tZXNzYWdlLFxuICAgICAgICB0YWdzOiBvcHRzLnRhZ1xuICAgIH0pO1xufVxuXG5jbGFzcyBWaWRlb0FwcCB7XG4gICAgcHVibGljIHN0YXRpYyBhc3NlcnQoY29uZGl0aW9uLCBtZXNzYWdlLCBlcnJvcj86RXJyb3IsIG9iamVjdD86YW55KSB7XG4gICAgICAgIGlmICghY29uZGl0aW9uKSB7XG4gICAgICAgICAgICBBcHBMb2cuZXJyb3IoXCJBc3NlcnRpb24gXCIgKyBtZXNzYWdlLCBlcnJvciwgb2JqZWN0KTtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCI7XG4gICAgICAgICAgICBpZiAodHlwZW9mIEVycm9yICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbWVzc2FnZTsgLy8gRmFsbGJhY2tcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEVKU09OY2FzdCh0aGVPYmplY3QpOkVKU09OIHtcblxuICAgICAgICByZXR1cm4gPEVKU09OPiB0aGVPYmplY3Q7XG4gICAgfVxufXRoaXMuVmlkZW9BcHAgPSBWaWRlb0FwcDtcblxuXG4iXX0=